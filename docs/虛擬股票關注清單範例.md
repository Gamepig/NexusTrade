# 虛擬股票關注清單範例

本範例使用Node.js後端與純JavaScript前端，展示如何建立虛擬股票的關注清單。這個範例包含了基本的API（新增、更新、刪除以及查詢功能）。當前使用Express來處理後端請求，而在前端則使用HTML與JavaScript來呈現資料及進行互動。

## Step 1: 建立專案並安裝Express

1. 創建一個新的資料夾，例如：
   ```
   mkdir stock-tracker
   cd stock-tracker
   ```

2. 初始化專案：
   ```
   npm init -y
   ```

3. 安裝Express：
   ```
   npm install express
   ```

## Step 2: 建立後端Express應用程式

建立一個`server.js`文件：

```javascript
// server.js

const express = require('express');
const app = express();
const port = process.env.PORT || 3000;

// 啟用 body parsing middleware，以處理 JSON 請求
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// 暫存目前的虛擬股票關注清單，實際應用中可替換成資料庫
let stocks = [
    { id: 1, name: 'ABC公司', price: 100 },
    { id: 2, name: 'XYZ公司', price: 200 }
];

// 提供 API 查詢所有股票
app.get('/api/stocks', (req, res) => {
    res.json(stocks);
});

// 新增股票
app.post('/api/stocks', (req, res) => {
    const { name, price } = req.body;
    if (!name || !price) {
        return res.status(400).json({ error: '名稱與價格都是必填的' });
    }
    const newStock = {
        id: stocks.length > 0 ? Math.max(...stocks.map(s => s.id)) + 1 : 1,
        name: name,
        price: Number(price)
    };
    stocks.push(newStock);
    res.status(201).json(newStock);
});

// 更新股票價格
app.put('/api/stocks/:id', (req, res) => {
    const { id } = req.params;
    const { price } = req.body;

    const stockIndex = stocks.findIndex(s => s.id === parseInt(id));
    if (stockIndex === -1) {
        return res.status(404).json({ error: '找不到該股票' });
    }

    if (price) {
        stocks[stockIndex].price = Number(price);
        res.json(stocks[stockIndex]);
    } else {
        res.status(400).json({ error: '價格為必填' });
    }
});

// 刪除股票
app.delete('/api/stocks/:id', (req, res) => {
    const { id } = req.params;
    const stockIndex = stocks.findIndex(s => s.id === parseInt(id));
    if (stockIndex === -1) {
        return res.status(404).json({ error: '找不到該股票' });
    }
    stocks.splice(stockIndex, 1);
    res.json({ message: '股票已成功刪除' });
});

app.listen(port, () => {
    console.log(`Server running on port ${port}`);
});
```

## Step 3: 建立前端HTML與JavaScript

建立一個`index.html`文件：

```html
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>虛擬股票關注清單</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>虛擬股票關注清單</h1>

    <div>
        <input type="text" id="stockName" placeholder="股票名稱">
        <input type="number" id="stockPrice" placeholder="股票價格">
        <button onclick="addStock()">新增股票</button>
    </div>

    <table id="stocksTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>名稱</th>
                <th>價格</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="stocksBody">
            <!-- 自動顯示資料 -->
        </tbody>
    </table>

<script>
// 從後端取得所有股票
function fetchStocks() {
    fetch('/api/stocks')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.getElementById('stocksBody');
            tableBody.innerHTML = '';
            data.forEach(stock => {
                const row = document.createElement('tr');
                
                // ID
                let tdId = document.createElement('td');
                tdId.textContent = stock.id;
                row.appendChild(tdId);

                // 名稱
                let tdName = document.createElement('td');
                tdName.textContent = stock.name;
                row.appendChild(tdName);

                // 價格
                let tdPrice = document.createElement('td');
                tdPrice.textContent = stock.price;
                row.appendChild(tdPrice);

                // 操作按鈕：更新價格與刪除
                let tdOperation = document.createElement('td');
                
                // 更新按鈕：開啟 prompt 修改價格
                const updateBtn = document.createElement('button');
                updateBtn.textContent = '更新價格';
                updateBtn.onclick = function(){
                    const newPrice = prompt('請輸入新的價格：', stock.price);
                    if(newPrice){
                        fetch('/api/stocks/' + stock.id, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ price: newPrice })
                        }).then(res => res.json())
                          .then(updatedStock => {
                              // 重新取得資料
                              fetchStocks();
                          });
                    }
                };
                tdOperation.appendChild(updateBtn);
                
                // 刪除按鈕
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '刪除';
                deleteBtn.onclick = function(){
                    if(confirm('確定要刪除這筆資料嗎？')){
                        fetch('/api/stocks/' + stock.id, {
                            method: 'DELETE'
                        }).then(() => {
                            // 重新取得資料
                            fetchStocks();
                        });
                    }
                };
                tdOperation.appendChild(deleteBtn);
                
                row.appendChild(tdOperation);
                tableBody.appendChild(row);
            });
        });
}

// 新增股票函式
function addStock() {
    const name = document.getElementById('stockName').value;
    const price = document.getElementById('stockPrice').value;

    fetch('/api/stocks', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, price })
    }).then(() => {
        // 清除輸入欄位
        document.getElementById('stockName').value = '';
        document.getElementById('stockPrice').value = '';
        // 重新取得資料
        fetchStocks();
    });
}

// 初始化時自動獲取資料
fetchStocks();

</script>
</body>
</html>
```

## Step 4: 調整 package.json

在 `package.json` 中新增一個 start 指令，例如：

```json
{
  "name": "stock-tracker",
  "version": "1.0.0",
  "description": "",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "express": "^4.x.x"
  }
}
```

## Step 5: 執行

在終端機中執行：
```
npm start
```

開啟瀏覽器於 [http://localhost:3000](http://localhost:3000) 即可看到虛擬股票關注清單。

---

這個Markdown文件包含了整個範例的程式碼與說明，方便你存到本機並進行開發與測試。希望對你有所幫助！