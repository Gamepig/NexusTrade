<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¾©é©—è­‰æ¸¬è©¦</title>
    <link rel="stylesheet" href="css/main.css?v=20250625fix6">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        .verification-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-results {
            background: #1a1f3a;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .indicator-test {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: #2d3748;
            border-radius: 8px;
            font-size: 14px;
        }
        .status-ok { color: #00d4aa; }
        .status-warning { color: #ffa502; }
        .status-error { color: #ff4757; }
        .ai-analysis-container {
            margin: 30px 0;
            border: 2px solid #2d3748;
            border-radius: 12px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="verification-container">
        <h1>ğŸ”§ AI åˆ†æä¿®å¾©é©—è­‰ - Llama 4 Scout æ¨¡å‹</h1>
        <p>é©—è­‰æ–°çš„ OpenRouter æ¨¡å‹é…ç½®å’Œæ•¸æ“šçµæ§‹ä¿®å¾©</p>
        
        <div class="test-results">
            <h2>ğŸ“Š æŠ€è¡“æŒ‡æ¨™æª¢æ¸¬çµæœ</h2>
            <div id="indicators-test-results">
                æ­£åœ¨æª¢æ¸¬...
            </div>
        </div>
        
        <div class="ai-analysis-container">
            <h2>ğŸ¨ å‰ç«¯çµ„ä»¶é¡¯ç¤ºæ¸¬è©¦</h2>
            <div id="ai-currency-analysis-container"></div>
        </div>
        
        <div class="test-results">
            <h2>ğŸ” å•é¡Œä¿®å¾©æª¢æŸ¥æ¸…å–®</h2>
            <div id="fix-checklist">
                è¼‰å…¥ä¸­...
            </div>
        </div>
    </div>

    <script src="js/components/AICurrencyAnalysis.js?v=20250625fix6"></script>
    
    <script>
        async function runVerificationTests() {
            console.log('ğŸ”§ é–‹å§‹ä¿®å¾©é©—è­‰æ¸¬è©¦...');
            
            try {
                // 1. æ¸¬è©¦ API æ•¸æ“š
                const response = await fetch('/api/ai/currency-analysis/BTCUSDT');
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayIndicatorResults(data.data.analysis.technicalAnalysis);
                    runFixChecklist(data.data.analysis.technicalAnalysis);
                } else {
                    document.getElementById('indicators-test-results').innerHTML = 
                        '<div class="status-error">âŒ API è«‹æ±‚å¤±æ•—: ' + data.message + '</div>';
                }
                
                // 2. æ¸¬è©¦å‰ç«¯çµ„ä»¶
                const aiComponent = new AICurrencyAnalysis('ai-currency-analysis-container', 'BTCUSDT');
                
            } catch (error) {
                console.error('é©—è­‰æ¸¬è©¦å¤±æ•—:', error);
                document.getElementById('indicators-test-results').innerHTML = 
                    '<div class="status-error">âŒ æ¸¬è©¦éç¨‹ç™¼ç”ŸéŒ¯èª¤: ' + error.message + '</div>';
            }
        }
        
        function displayIndicatorResults(indicators) {
            const container = document.getElementById('indicators-test-results');
            let html = '';
            
            const expectedIndicators = ['rsi', 'macd', 'movingAverage', 'bollingerBands', 'volume', 'williamsR'];
            
            expectedIndicators.forEach(key => {
                const indicator = indicators[key];
                const exists = !!indicator;
                
                if (!exists) {
                    html += `<div class="indicator-test">
                        <div class="status-error">âŒ ${key}</div>
                        <div>ä¸å­˜åœ¨</div>
                        <div>-</div>
                        <div>-</div>
                    </div>`;
                    return;
                }
                
                const value = indicator.value;
                const interpretation = indicator.interpretation;
                const signal = indicator.signal;
                
                // æª¢æŸ¥æ˜¯å¦æœ‰ N/A, null, undefined å•é¡Œ
                const hasValueIssue = value === 'N/A' || value === 'null' || value === 'undefined';
                const hasInterpretationIssue = interpretation === 'N/A' || interpretation === 'null' || interpretation === 'undefined';
                const hasSignalIssue = signal === 'N/A' || signal === 'null' || signal === 'undefined' || !signal;
                
                const valueStatus = hasValueIssue ? 'status-error' : (value === null ? 'status-warning' : 'status-ok');
                const interpretationStatus = hasInterpretationIssue ? 'status-error' : (!interpretation ? 'status-warning' : 'status-ok');
                const signalStatus = hasSignalIssue ? 'status-error' : 'status-ok';
                
                html += `<div class="indicator-test">
                    <div class="status-ok">âœ… ${key}</div>
                    <div class="${valueStatus}">å€¼: ${value === null ? 'null (æ­£å¸¸)' : (hasValueIssue ? 'âŒ ' + value : 'âœ… ' + value)}</div>
                    <div class="${interpretationStatus}">è§£è®€: ${!interpretation ? 'âš ï¸ ç©ºå€¼' : (hasInterpretationIssue ? 'âŒ ' + interpretation : 'âœ… æ­£å¸¸')}</div>
                    <div class="${signalStatus}">ä¿¡è™Ÿ: ${hasSignalIssue ? 'âŒ ' + signal : 'âœ… ' + signal}</div>
                </div>`;
            });
            
            container.innerHTML = html;
        }
        
        function runFixChecklist(indicators) {
            const checklist = [
                {
                    name: '6 å€‹æŠ€è¡“æŒ‡æ¨™å®Œæ•´å­˜åœ¨',
                    test: () => Object.keys(indicators).length === 6,
                    description: 'ç¢ºä¿ RSI, MACD, ç§»å‹•å¹³å‡ç·š, å¸ƒæ—é€šé“, æˆäº¤é‡, Williams %R éƒ½å­˜åœ¨'
                },
                {
                    name: 'æ²’æœ‰ "N/A" å­—ä¸²å€¼',
                    test: () => {
                        return !Object.values(indicators).some(indicator => {
                            return indicator.value === 'N/A' || indicator.interpretation === 'N/A' || indicator.signal === 'N/A';
                        });
                    },
                    description: 'æ‰€æœ‰ "N/A" å€¼éƒ½æ‡‰è©²è¢«æ­£ç¢ºè™•ç†'
                },
                {
                    name: 'æ²’æœ‰ "undefined" å­—ä¸²å€¼',
                    test: () => {
                        return !Object.values(indicators).some(indicator => {
                            return indicator.value === 'undefined' || indicator.interpretation === 'undefined' || indicator.signal === 'undefined';
                        });
                    },
                    description: 'æ‰€æœ‰ "undefined" å€¼éƒ½æ‡‰è©²è¢«æ­£ç¢ºè™•ç†'
                },
                {
                    name: 'æ‰€æœ‰ä¿¡è™Ÿæ¬„ä½éƒ½æœ‰å€¼',
                    test: () => {
                        return Object.values(indicators).every(indicator => indicator.signal && indicator.signal.trim() !== '');
                    },
                    description: 'æ¯å€‹æŠ€è¡“æŒ‡æ¨™éƒ½æ‡‰è©²æœ‰æ˜ç¢ºçš„ä¿¡è™Ÿ'
                },
                {
                    name: 'Williams %R æŒ‡æ¨™å­˜åœ¨',
                    test: () => !!indicators.williamsR,
                    description: 'ç¬¬6å€‹æŠ€è¡“æŒ‡æ¨™ Williams %R æ‡‰è©²å­˜åœ¨'
                }
            ];
            
            let html = '';
            let passedCount = 0;
            
            checklist.forEach(check => {
                const passed = check.test();
                if (passed) passedCount++;
                
                html += `<div style="margin: 10px 0; padding: 10px; background: ${passed ? '#1a4d3a' : '#4d1a1a'}; border-radius: 8px;">
                    <div style="font-weight: bold; color: ${passed ? '#00d4aa' : '#ff4757'};">
                        ${passed ? 'âœ…' : 'âŒ'} ${check.name}
                    </div>
                    <div style="font-size: 14px; color: #a0aec0; margin-top: 5px;">
                        ${check.description}
                    </div>
                </div>`;
            });
            
            const overallStatus = passedCount === checklist.length ? 'âœ… å…¨éƒ¨é€šé' : `âš ï¸ ${passedCount}/${checklist.length} é …é€šé`;
            
            html = `<div style="margin-bottom: 20px; padding: 15px; background: ${passedCount === checklist.length ? '#1a4d3a' : '#4d3a1a'}; border-radius: 8px; text-align: center; font-size: 18px; font-weight: bold;">
                ${overallStatus}
            </div>` + html;
            
            document.getElementById('fix-checklist').innerHTML = html;
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œé–‹å§‹æ¸¬è©¦
        window.addEventListener('load', () => {
            runVerificationTests();
        });
    </script>
</body>
</html>