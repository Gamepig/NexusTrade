<!DOCTYPE html>
<html>
<head>
    <title>NexusTrade å‰ç«¯ç³»çµ±æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>NexusTrade å‰ç«¯ç³»çµ±æ¸¬è©¦</h1>
    <div id="test-results"></div>

    <!-- è¼‰å…¥ NexusTrade æ¨¡çµ„ -->
    <script src="/js/lib/api.js"></script>
    <script src="/js/lib/dom.js"></script>
    <script src="/js/lib/router.js"></script>
    <script src="/js/state/store.js"></script>

    <script>
        // æ¸¬è©¦çµæœå®¹å™¨
        const resultsContainer = document.getElementById('test-results');

        function addTestResult(name, success, details = '') {
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <strong>${success ? 'âœ…' : 'âŒ'} ${name}</strong>
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            resultsContainer.appendChild(div);
        }

        // æ¸¬è©¦æ¨¡çµ„è¼‰å…¥
        function testModuleLoading() {
            try {
                addTestResult('API æ¨¡çµ„è¼‰å…¥', typeof ApiClient !== 'undefined');
                addTestResult('DOM å·¥å…·æ¨¡çµ„è¼‰å…¥', typeof DOMUtils !== 'undefined');
                addTestResult('è·¯ç”±æ¨¡çµ„è¼‰å…¥', typeof Router !== 'undefined');
                addTestResult('ç‹€æ…‹ç®¡ç†æ¨¡çµ„è¼‰å…¥', typeof Store !== 'undefined');
                addTestResult('å…¨åŸŸ API å¯¦ä¾‹', typeof api !== 'undefined');
                addTestResult('å…¨åŸŸç‹€æ…‹å„²å­˜å™¨', typeof store !== 'undefined');
            } catch (error) {
                addTestResult('æ¨¡çµ„è¼‰å…¥æ¸¬è©¦', false, error.message);
            }
        }

        // æ¸¬è©¦ API åŠŸèƒ½
        async function testApiFunctionality() {
            try {
                // æ¸¬è©¦å¥åº·æª¢æŸ¥
                const health = await api.getHealth();
                addTestResult('API å¥åº·æª¢æŸ¥', health.status === 'healthy', JSON.stringify(health));

                // æ¸¬è©¦ API æ¸¬è©¦ç«¯é»
                const testResult = await api.testApi();
                addTestResult('API æ¸¬è©¦ç«¯é»', testResult.status === 'success', JSON.stringify(testResult));
            } catch (error) {
                addTestResult('API åŠŸèƒ½æ¸¬è©¦', false, error.message);
            }
        }

        // æ¸¬è©¦è·¯ç”±åŠŸèƒ½
        function testRouterFunctionality() {
            try {
                const router = new Router();
                
                // è¨»å†Šæ¸¬è©¦è·¯ç”±
                router.route('/test', () => {
                    console.log('æ¸¬è©¦è·¯ç”±è¢«è§¸ç™¼');
                });

                addTestResult('è·¯ç”±è¨»å†Š', router.routes.has('/test'));
                addTestResult('è·¯å¾‘æ¨™æº–åŒ–', router.normalizePath('#/test/') === '/test');
                addTestResult('è·¯ç”±åŒ¹é…', router.matchRoute('/test') !== null);
            } catch (error) {
                addTestResult('è·¯ç”±åŠŸèƒ½æ¸¬è©¦', false, error.message);
            }
        }

        // æ¸¬è©¦ç‹€æ…‹ç®¡ç†åŠŸèƒ½
        function testStateManagement() {
            try {
                const testStore = new Store({ count: 0 });
                
                // æ¸¬è©¦ç‹€æ…‹è®€å–
                addTestResult('ç‹€æ…‹è®€å–', testStore.getState().count === 0);
                
                // æ¸¬è©¦ç‹€æ…‹æ›´æ–°
                testStore.setState({ count: 1 });
                addTestResult('ç‹€æ…‹æ›´æ–°', testStore.getState().count === 1);
                
                // æ¸¬è©¦å·¢ç‹€ç‹€æ…‹
                testStore.updateState('nested.value', 'test');
                addTestResult('å·¢ç‹€ç‹€æ…‹æ›´æ–°', testStore.getStateValue('nested.value') === 'test');
                
                // æ¸¬è©¦å…¨åŸŸç‹€æ…‹å„²å­˜å™¨
                addTestResult('å…¨åŸŸç‹€æ…‹å„²å­˜å™¨åˆå§‹åŒ–', store.getState().auth !== undefined);
            } catch (error) {
                addTestResult('ç‹€æ…‹ç®¡ç†æ¸¬è©¦', false, error.message);
            }
        }

        // æ¸¬è©¦ DOM å·¥å…·
        function testDOMUtils() {
            try {
                // å»ºç«‹æ¸¬è©¦å…ƒç´ 
                const testEl = DOMUtils.create('div', {
                    className: 'test-element',
                    textContent: 'Test'
                });
                
                addTestResult('DOM å…ƒç´ å»ºç«‹', testEl.tagName === 'DIV');
                addTestResult('DOM é¡åˆ¥è¨­å®š', testEl.classList.contains('test-element'));
                addTestResult('DOM å…§å®¹è¨­å®š', testEl.textContent === 'Test');
                
                // æ¸¬è©¦é¸æ“‡å™¨
                addTestResult('DOM é¸æ“‡å™¨', typeof DOMUtils.$ === 'function');
            } catch (error) {
                addTestResult('DOM å·¥å…·æ¸¬è©¦', false, error.message);
            }
        }

        // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        async function runAllTests() {
            console.log('ğŸ§ª é–‹å§‹åŸ·è¡Œå‰ç«¯ç³»çµ±æ¸¬è©¦...');
            
            testModuleLoading();
            testDOMUtils();
            testRouterFunctionality();
            testStateManagement();
            await testApiFunctionality();
            
            console.log('âœ… å‰ç«¯ç³»çµ±æ¸¬è©¦å®Œæˆ');
        }

        // é é¢è¼‰å…¥å¾ŒåŸ·è¡Œæ¸¬è©¦
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>