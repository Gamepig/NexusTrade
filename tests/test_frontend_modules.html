<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusTrade å‰ç«¯æ¨¡çµ„æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #2a2a2a;
        }
        .test-button {
            margin: 5px;
            padding: 10px 20px;
            background: #f7931a;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #e8830f;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #0f0f0f;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª NexusTrade å‰ç«¯æ¨¡çµ„æ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>1. ç‹€æ…‹ç®¡ç†æ¸¬è©¦</h2>
        <button class="test-button" onclick="testStore()">æ¸¬è©¦ Store</button>
        <button class="test-button" onclick="testActions()">æ¸¬è©¦ Actions</button>
        <button class="test-button" onclick="testSubscription()">æ¸¬è©¦è¨‚é–±</button>
        <div id="store-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. API å®¢æˆ¶ç«¯æ¸¬è©¦</h2>
        <button class="test-button" onclick="testHealthAPI()">æ¸¬è©¦å¥åº·æª¢æŸ¥</button>
        <button class="test-button" onclick="testSystemAPI()">æ¸¬è©¦ç³»çµ±ç‹€æ…‹</button>
        <button class="test-button" onclick="testErrorHandling()">æ¸¬è©¦éŒ¯èª¤è™•ç†</button>
        <div id="api-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. è·¯ç”±ç³»çµ±æ¸¬è©¦</h2>
        <button class="test-button" onclick="testRouter()">åˆå§‹åŒ–è·¯ç”±</button>
        <button class="test-button" onclick="navigateTest('dashboard')">å°èˆªåˆ°å„€è¡¨æ¿</button>
        <button class="test-button" onclick="navigateTest('market')">å°èˆªåˆ°å¸‚å ´</button>
        <button class="test-button" onclick="navigateTest('invalid')">æ¸¬è©¦ 404</button>
        <div id="router-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. é€šçŸ¥ç³»çµ±æ¸¬è©¦</h2>
        <button class="test-button" onclick="testNotifications('success')">æˆåŠŸé€šçŸ¥</button>
        <button class="test-button" onclick="testNotifications('error')">éŒ¯èª¤é€šçŸ¥</button>
        <button class="test-button" onclick="testNotifications('warning')">è­¦å‘Šé€šçŸ¥</button>
        <button class="test-button" onclick="testNotifications('info')">è¨Šæ¯é€šçŸ¥</button>
        <div id="notification-result" class="result"></div>
    </div>

    <!-- è¼‰å…¥å‰ç«¯æ¨¡çµ„ -->
    <script src="/js/lib/api.js"></script>
    <script src="/js/lib/router.js"></script>
    <script src="/js/state/store.js"></script>
    <script src="/js/components/Notification.js"></script>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let store;
        let router;
        let notificationComponent;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ');
            
            // åˆå§‹åŒ–ç‹€æ…‹ç®¡ç†
            store = StoreFactory.createNexusTradeStore();
            
            // åˆå§‹åŒ–é€šçŸ¥çµ„ä»¶
            notificationComponent = new NotificationComponent();
            
            // åˆå§‹åŒ–è·¯ç”±ï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
            router = RouteBuilder.create()
                .dashboard(() => updateResult('router-result', 'âœ… å°èˆªåˆ°å„€è¡¨æ¿'))
                .market(() => updateResult('router-result', 'âœ… å°èˆªåˆ°å¸‚å ´'))
                .notFound((ctx) => updateResult('router-result', `âŒ 404: ${ctx.path}`))
                .build();
            
            updateResult('store-result', 'ğŸª ç‹€æ…‹ç®¡ç†ç³»çµ±å·²åˆå§‹åŒ–');
            updateResult('api-result', 'ğŸ“¡ API å®¢æˆ¶ç«¯å·²æº–å‚™');
            updateResult('router-result', 'ğŸ§­ è·¯ç”±ç³»çµ±å·²åˆå§‹åŒ–');
            updateResult('notification-result', 'ğŸ“¢ é€šçŸ¥çµ„ä»¶å·²åˆå§‹åŒ–');
        });

        // è¼”åŠ©å‡½æ•¸
        function updateResult(elementId, text) {
            const element = document.getElementById(elementId);
            element.textContent = new Date().toLocaleTimeString() + ' - ' + text;
        }

        // ç‹€æ…‹ç®¡ç†æ¸¬è©¦
        function testStore() {
            try {
                const state = store.getState();
                updateResult('store-result', `âœ… ç‹€æ…‹å–å¾—æˆåŠŸ:\n${JSON.stringify(state, null, 2)}`);
            } catch (error) {
                updateResult('store-result', `âŒ ç‹€æ…‹æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        function testActions() {
            try {
                store.dispatch(ActionCreators.setCurrentPage('test-page'));
                store.dispatch(ActionCreators.setLoading(true, 'æ¸¬è©¦è¼‰å…¥ä¸­...'));
                
                setTimeout(() => {
                    store.dispatch(ActionCreators.setLoading(false));
                    const state = store.getState();
                    updateResult('store-result', `âœ… Actions æ¸¬è©¦æˆåŠŸ:\nCurrentPage: ${state.ui.currentPage}\nLoading: ${state.ui.loading.isLoading}`);
                }, 1000);
            } catch (error) {
                updateResult('store-result', `âŒ Actions æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        function testSubscription() {
            try {
                let changeCount = 0;
                const unsubscribe = store.subscribe((newState, prevState) => {
                    changeCount++;
                    updateResult('store-result', `âœ… ç‹€æ…‹è®ŠåŒ–ç›£è½: ç¬¬${changeCount}æ¬¡è®ŠåŒ–`);
                });
                
                // è§¸ç™¼ç‹€æ…‹è®ŠåŒ–
                store.dispatch(ActionCreators.setCurrentPage('subscription-test'));
                
                // 3ç§’å¾Œå–æ¶ˆè¨‚é–±
                setTimeout(() => {
                    unsubscribe();
                    updateResult('store-result', `âœ… è¨‚é–±æ¸¬è©¦å®Œæˆï¼Œå·²å–æ¶ˆè¨‚é–±`);
                }, 3000);
            } catch (error) {
                updateResult('store-result', `âŒ è¨‚é–±æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        // API æ¸¬è©¦
        async function testHealthAPI() {
            try {
                updateResult('api-result', 'â³ æ¸¬è©¦å¥åº·æª¢æŸ¥ API...');
                const response = await window.api.getHealth();
                updateResult('api-result', `âœ… å¥åº·æª¢æŸ¥æˆåŠŸ:\n${JSON.stringify(response, null, 2)}`);
            } catch (error) {
                updateResult('api-result', `âŒ å¥åº·æª¢æŸ¥å¤±æ•—: ${error.message}`);
            }
        }

        async function testSystemAPI() {
            try {
                updateResult('api-result', 'â³ æ¸¬è©¦ç³»çµ±ç‹€æ…‹ API...');
                const response = await window.api.getSystemStatus();
                updateResult('api-result', `âœ… ç³»çµ±ç‹€æ…‹æˆåŠŸ:\n${JSON.stringify(response, null, 2)}`);
            } catch (error) {
                updateResult('api-result', `âŒ ç³»çµ±ç‹€æ…‹å¤±æ•—: ${error.message}`);
            }
        }

        async function testErrorHandling() {
            try {
                updateResult('api-result', 'â³ æ¸¬è©¦éŒ¯èª¤è™•ç†...');
                await window.api.client.get('/api/nonexistent');
            } catch (error) {
                if (error instanceof ApiError) {
                    updateResult('api-result', `âœ… éŒ¯èª¤è™•ç†æˆåŠŸ:\nStatus: ${error.status}\nMessage: ${error.message}`);
                } else {
                    updateResult('api-result', `âŒ éŒ¯èª¤è™•ç†ç•°å¸¸: ${error.message}`);
                }
            }
        }

        // è·¯ç”±æ¸¬è©¦
        function testRouter() {
            try {
                const currentPath = router.getCurrentPath();
                updateResult('router-result', `âœ… è·¯ç”±åˆå§‹åŒ–æˆåŠŸ\nç•¶å‰è·¯å¾‘: ${currentPath}`);
            } catch (error) {
                updateResult('router-result', `âŒ è·¯ç”±æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        function navigateTest(path) {
            try {
                router.navigate(`/${path}`);
                updateResult('router-result', `â³ å°èˆªåˆ°: /${path}`);
            } catch (error) {
                updateResult('router-result', `âŒ å°èˆªå¤±æ•—: ${error.message}`);
            }
        }

        // é€šçŸ¥æ¸¬è©¦
        function testNotifications(type) {
            try {
                const messages = {
                    success: 'é€™æ˜¯ä¸€å€‹æˆåŠŸé€šçŸ¥ï¼',
                    error: 'é€™æ˜¯ä¸€å€‹éŒ¯èª¤é€šçŸ¥ï¼',
                    warning: 'é€™æ˜¯ä¸€å€‹è­¦å‘Šé€šçŸ¥ï¼',
                    info: 'é€™æ˜¯ä¸€å€‹è¨Šæ¯é€šçŸ¥ï¼'
                };
                
                store.dispatch(ActionCreators.showNotification(messages[type], type, 3000));
                updateResult('notification-result', `âœ… ${type} é€šçŸ¥å·²è§¸ç™¼`);
            } catch (error) {
                updateResult('notification-result', `âŒ é€šçŸ¥æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }
    </script>
</body>
</html>