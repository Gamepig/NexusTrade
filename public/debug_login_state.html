<!DOCTYPE html>
<html>
<head>
    <title>ç™»å…¥ç‹€æ…‹é™¤éŒ¯</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .info { background: #d1ecf1; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ç™»å…¥ç‹€æ…‹é™¤éŒ¯</h1>
    
    <div class="section">
        <button onclick="debugLoginState()">æª¢æŸ¥ç™»å…¥ç‹€æ…‹</button>
        <button onclick="clearState()">æ¸…é™¤ç‹€æ…‹</button>
        <button onclick="forceUpdateUI()">å¼·åˆ¶æ›´æ–° UI</button>
    </div>
    
    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `section ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(`[${type}] ${message}`);
        }

        function debugLoginState() {
            log('<h3>ğŸ“‹ localStorage å…§å®¹æª¢æŸ¥</h3>', 'info');
            
            // æª¢æŸ¥æ‰€æœ‰ localStorage é …ç›®
            const token = localStorage.getItem('nexustrade_token');
            const refreshToken = localStorage.getItem('nexustrade_refresh_token');
            const user = localStorage.getItem('nexustrade_user');
            
            log(`<strong>Token:</strong> ${token ? 'exists (length: ' + token.length + ')' : 'not found'}`, token ? 'success' : 'error');
            log(`<strong>Refresh Token:</strong> ${refreshToken ? 'exists' : 'not found'}`, refreshToken ? 'success' : 'error');
            log(`<strong>User Data:</strong> ${user ? 'exists' : 'not found'}`, user ? 'success' : 'error');
            
            if (token) {
                log(`<strong>Token preview:</strong> ${token.substring(0, 50)}...`, 'info');
            }
            
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    log(`<strong>User object:</strong><pre>${JSON.stringify(userData, null, 2)}</pre>`, 'info');
                } catch (e) {
                    log(`<strong>User parse error:</strong> ${e.message}`, 'error');
                    log(`<strong>Raw user data:</strong> ${user}`, 'error');
                }
            }
            
            log('<h3>ğŸ” LoginModal ç‹€æ…‹æª¢æŸ¥</h3>', 'info');
            
            // æª¢æŸ¥ LoginModal å¯¦ä¾‹
            if (window.loginModal) {
                log('âœ… LoginModal å¯¦ä¾‹å­˜åœ¨', 'success');
                
                // æª¢æŸ¥ authTokens
                const authTokens = window.loginModal.authTokens;
                log(`<strong>authTokens:</strong><pre>${JSON.stringify(authTokens, null, 2)}</pre>`, 'info');
                
                // æª¢æŸ¥ loadTokensFromStorage æ–¹æ³•
                const loadedTokens = window.loginModal.loadTokensFromStorage();
                log(`<strong>loadTokensFromStorage result:</strong><pre>${JSON.stringify(loadedTokens, null, 2)}</pre>`, 'info');
                
            } else {
                log('âŒ LoginModal å¯¦ä¾‹ä¸å­˜åœ¨', 'error');
            }
            
            log('<h3>ğŸ–¥ï¸ DOM å…ƒç´ æª¢æŸ¥</h3>', 'info');
            
            const loginBtn = document.getElementById('login-btn');
            const userMenu = document.querySelector('.user-menu');
            
            log(`<strong>Login Button:</strong> ${loginBtn ? 'exists (display: ' + getComputedStyle(loginBtn).display + ')' : 'not found'}`, loginBtn ? 'success' : 'error');
            log(`<strong>User Menu:</strong> ${userMenu ? 'exists (display: ' + getComputedStyle(userMenu).display + ')' : 'not found'}`, userMenu ? 'success' : 'error');
        }

        function clearState() {
            localStorage.clear();
            log('ğŸ§¹ æ‰€æœ‰ localStorage å·²æ¸…é™¤', 'success');
            window.location.reload();
        }

        function forceUpdateUI() {
            if (window.loginModal) {
                const user = localStorage.getItem('nexustrade_user');
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        log('ğŸ”„ å¼·åˆ¶æ›´æ–° UI...', 'info');
                        window.loginModal.updateUIForLoggedInUser(userData);
                        log('âœ… UI æ›´æ–°å®Œæˆ', 'success');
                    } catch (e) {
                        log(`âŒ å¼·åˆ¶æ›´æ–°å¤±æ•—: ${e.message}`, 'error');
                    }
                } else {
                    log('âŒ æ²’æœ‰ä½¿ç”¨è€…è³‡æ–™å¯æ›´æ–°', 'error');
                }
            } else {
                log('âŒ LoginModal å¯¦ä¾‹ä¸å­˜åœ¨', 'error');
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', function() {
            log('ğŸ“„ é é¢è¼‰å…¥å®Œæˆï¼Œè‡ªå‹•æª¢æŸ¥ç‹€æ…‹...', 'info');
            setTimeout(debugLoginState, 1000);
        });
    </script>
</body>
</html>