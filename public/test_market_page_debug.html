<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸‚å ´é é¢é™¤éŒ¯å·¥å…·</title>
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body { padding: 20px; background: var(--background-primary); color: var(--text-primary); }
        .debug-section { margin: 20px 0; padding: 15px; background: var(--background-secondary); border-radius: 8px; }
        .debug-title { color: var(--primary-color); font-weight: 600; margin-bottom: 10px; }
        .debug-output { background: var(--background-primary); padding: 10px; border-radius: 4px; font-family: monospace; font-size: 0.9rem; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .test-btn { background: var(--primary-color); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .test-btn:hover { background: var(--primary-dark); }
        .error { color: var(--danger-color); }
        .success { color: var(--secondary-color); }
    </style>
</head>
<body>
    <h1>ğŸ› å¸‚å ´é é¢é™¤éŒ¯å·¥å…·</h1>
    
    <div class="debug-section">
        <div class="debug-title">ğŸ“‹ çµ„ä»¶è¼‰å…¥æª¢æŸ¥</div>
        <button class="test-btn" onclick="checkComponents()">æª¢æŸ¥çµ„ä»¶è¼‰å…¥</button>
        <div id="component-check" class="debug-output"></div>
    </div>
    
    <div class="debug-section">
        <div class="debug-title">ğŸ”Œ API ç«¯é»æ¸¬è©¦</div>
        <button class="test-btn" onclick="testMarketStats()">æ¸¬è©¦å¸‚å ´çµ±è¨ˆ API</button>
        <button class="test-btn" onclick="testBatchPrices()">æ¸¬è©¦æ‰¹é‡åƒ¹æ ¼ API</button>
        <button class="test-btn" onclick="testTrendingPairs()">æ¸¬è©¦ç†±é–€äº¤æ˜“å° API</button>
        <div id="api-test" class="debug-output"></div>
    </div>
    
    <div class="debug-section">
        <div class="debug-title">ğŸ¨ DOM å…ƒç´ æª¢æŸ¥</div>
        <button class="test-btn" onclick="checkDOMElements()">æª¢æŸ¥ DOM å…ƒç´ </button>
        <div id="dom-check" class="debug-output"></div>
    </div>
    
    <div class="debug-section">
        <div class="debug-title">ğŸ§ª çµ„ä»¶åˆå§‹åŒ–æ¸¬è©¦</div>
        <button class="test-btn" onclick="testMarketPageComponent()">æ¸¬è©¦ MarketPage çµ„ä»¶</button>
        <button class="test-btn" onclick="testCryptoCurrencyList()">æ¸¬è©¦ CryptoCurrencyList çµ„ä»¶</button>
        <div id="component-test" class="debug-output"></div>
    </div>
    
    <div class="debug-section">
        <div class="debug-title">ğŸ“Š å¯¦éš›å¸‚å ´é é¢æ¸¬è©¦</div>
        <div style="border: 1px solid var(--border-color); padding: 15px; border-radius: 8px;">
            <!-- å¸‚å ´çµ±è¨ˆæ¸¬è©¦ -->
            <div id="test-market-stats" class="market-stats">
                <div class="market-stat">
                    <div class="stat-label">è¼‰å…¥ä¸­...</div>
                    <div class="stat-value">-</div>
                </div>
            </div>
            
            <!-- è²¨å¹£åˆ—è¡¨æ¸¬è©¦ -->
            <div style="margin-top: 20px;">
                <h4>è²¨å¹£åˆ—è¡¨æ¸¬è©¦</h4>
                <div id="test-market-coins-grid" class="crypto-list-container">
                    <div class="crypto-loading">
                        <div class="crypto-loading-spinner"></div>
                        <div class="crypto-loading-text">è¼‰å…¥æ¸¬è©¦æ•¸æ“šä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript æ¨¡çµ„ -->
    <script src="/js/lib/api.js"></script>
    <script src="/js/components/CryptoCurrencyList.js"></script>
    <script src="/js/components/HomeCryptoList.js"></script>
    <script src="/js/components/MarketPage.js"></script>
    
    <script>
        // æª¢æŸ¥çµ„ä»¶è¼‰å…¥
        function checkComponents() {
            const output = document.getElementById('component-check');
            let result = 'çµ„ä»¶è¼‰å…¥æª¢æŸ¥çµæœï¼š\n\n';
            
            const components = [
                'CryptoCurrencyList',
                'HomeCryptoList', 
                'MarketPage'
            ];
            
            components.forEach(comp => {
                if (typeof window[comp] !== 'undefined') {
                    result += `âœ… ${comp}: å·²è¼‰å…¥\n`;
                } else {
                    result += `âŒ ${comp}: æœªè¼‰å…¥\n`;
                }
            });
            
            output.textContent = result;
        }
        
        // æ¸¬è©¦å¸‚å ´çµ±è¨ˆ API
        async function testMarketStats() {
            const output = document.getElementById('api-test');
            output.textContent = 'æ¸¬è©¦å¸‚å ´çµ±è¨ˆ API...\n';
            
            try {
                const response = await fetch('/api/market/stats24h');
                const data = await response.json();
                output.textContent += '\nâœ… å¸‚å ´çµ±è¨ˆ API å›æ‡‰ï¼š\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                output.textContent += '\nâŒ å¸‚å ´çµ±è¨ˆ API éŒ¯èª¤ï¼š\n' + error.message;
            }
        }
        
        // æ¸¬è©¦æ‰¹é‡åƒ¹æ ¼ API
        async function testBatchPrices() {
            const output = document.getElementById('api-test');
            output.textContent = 'æ¸¬è©¦æ‰¹é‡åƒ¹æ ¼ API...\n';
            
            try {
                const response = await fetch('/api/market/batch-prices?symbols=BTCUSDT,ETHUSDT,BNBUSDT');
                const data = await response.json();
                output.textContent += '\nâœ… æ‰¹é‡åƒ¹æ ¼ API å›æ‡‰ï¼š\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                output.textContent += '\nâŒ æ‰¹é‡åƒ¹æ ¼ API éŒ¯èª¤ï¼š\n' + error.message;
            }
        }
        
        // æ¸¬è©¦ç†±é–€äº¤æ˜“å° API
        async function testTrendingPairs() {
            const output = document.getElementById('api-test');
            output.textContent = 'æ¸¬è©¦ç†±é–€äº¤æ˜“å° API...\n';
            
            try {
                const response = await fetch('/api/market/trending?limit=10');
                const data = await response.json();
                output.textContent += '\nâœ… ç†±é–€äº¤æ˜“å° API å›æ‡‰ï¼š\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                output.textContent += '\nâŒ ç†±é–€äº¤æ˜“å° API éŒ¯èª¤ï¼š\n' + error.message;
            }
        }
        
        // æª¢æŸ¥ DOM å…ƒç´ 
        function checkDOMElements() {
            const output = document.getElementById('dom-check');
            let result = 'DOM å…ƒç´ æª¢æŸ¥çµæœï¼š\n\n';
            
            const elements = [
                'test-market-stats',
                'test-market-coins-grid'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    result += `âœ… #${id}: å­˜åœ¨\n`;
                } else {
                    result += `âŒ #${id}: ä¸å­˜åœ¨\n`;
                }
            });
            
            output.textContent = result;
        }
        
        // æ¸¬è©¦ MarketPage çµ„ä»¶
        function testMarketPageComponent() {
            const output = document.getElementById('component-test');
            output.textContent = 'æ¸¬è©¦ MarketPage çµ„ä»¶...\n';
            
            try {
                if (typeof MarketPage === 'undefined') {
                    output.textContent += 'âŒ MarketPage çµ„ä»¶æœªè¼‰å…¥\n';
                    return;
                }
                
                // æ¸¬è©¦åˆå§‹åŒ–
                const marketPage = new MarketPage();
                output.textContent += 'âœ… MarketPage çµ„ä»¶åˆå§‹åŒ–æˆåŠŸ\n';
                
                // æ¸¬è©¦æ–¹æ³•å­˜åœ¨
                const methods = ['loadMarketStats', 'renderMarketStats', 'refresh'];
                methods.forEach(method => {
                    if (typeof marketPage[method] === 'function') {
                        output.textContent += `âœ… æ–¹æ³• ${method}: å­˜åœ¨\n`;
                    } else {
                        output.textContent += `âŒ æ–¹æ³• ${method}: ä¸å­˜åœ¨\n`;
                    }
                });
                
            } catch (error) {
                output.textContent += 'âŒ MarketPage çµ„ä»¶æ¸¬è©¦å¤±æ•—ï¼š\n' + error.message;
            }
        }
        
        // æ¸¬è©¦ CryptoCurrencyList çµ„ä»¶
        function testCryptoCurrencyList() {
            const output = document.getElementById('component-test');
            output.textContent = 'æ¸¬è©¦ CryptoCurrencyList çµ„ä»¶...\n';
            
            try {
                if (typeof CryptoCurrencyList === 'undefined') {
                    output.textContent += 'âŒ CryptoCurrencyList çµ„ä»¶æœªè¼‰å…¥\n';
                    return;
                }
                
                const container = document.getElementById('test-market-coins-grid');
                if (!container) {
                    output.textContent += 'âŒ æ¸¬è©¦å®¹å™¨ä¸å­˜åœ¨\n';
                    return;
                }
                
                // æ¸¬è©¦åˆå§‹åŒ–
                const cryptoList = new CryptoCurrencyList({
                    container: container,
                    mode: 'infinite',
                    maxCoins: 20,
                    coinsPerPage: 10,
                    updateInterval: 15000
                });
                
                output.textContent += 'âœ… CryptoCurrencyList çµ„ä»¶åˆå§‹åŒ–æˆåŠŸ\n';
                output.textContent += `âœ… å®¹å™¨: ${container.id}\n`;
                output.textContent += `âœ… æ¨¡å¼: infinite\n`;
                output.textContent += `âœ… æœ€å¤§è²¨å¹£æ•¸: 20\n`;
                
            } catch (error) {
                output.textContent += 'âŒ CryptoCurrencyList çµ„ä»¶æ¸¬è©¦å¤±æ•—ï¼š\n' + error.message + '\n' + error.stack;
            }
        }
        
        // è‡ªå‹•é‹è¡Œåˆå§‹æª¢æŸ¥
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                checkComponents();
                checkDOMElements();
            }, 500);
        });
    </script>
</body>
</html>