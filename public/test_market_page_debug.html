<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>市場頁面除錯工具</title>
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body { padding: 20px; background: var(--background-primary); color: var(--text-primary); }
        .debug-section { margin: 20px 0; padding: 15px; background: var(--background-secondary); border-radius: 8px; }
        .debug-title { color: var(--primary-color); font-weight: 600; margin-bottom: 10px; }
        .debug-output { background: var(--background-primary); padding: 10px; border-radius: 4px; font-family: monospace; font-size: 0.9rem; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .test-btn { background: var(--primary-color); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .test-btn:hover { background: var(--primary-dark); }
        .error { color: var(--danger-color); }
        .success { color: var(--secondary-color); }
    </style>
</head>
<body>
    <h1>🐛 市場頁面除錯工具</h1>
    
    <div class="debug-section">
        <div class="debug-title">📋 組件載入檢查</div>
        <button class="test-btn" onclick="checkComponents()">檢查組件載入</button>
        <div id="component-check" class="debug-output"></div>
    </div>
    
    <div class="debug-section">
        <div class="debug-title">🔌 API 端點測試</div>
        <button class="test-btn" onclick="testMarketStats()">測試市場統計 API</button>
        <button class="test-btn" onclick="testBatchPrices()">測試批量價格 API</button>
        <button class="test-btn" onclick="testTrendingPairs()">測試熱門交易對 API</button>
        <div id="api-test" class="debug-output"></div>
    </div>
    
    <div class="debug-section">
        <div class="debug-title">🎨 DOM 元素檢查</div>
        <button class="test-btn" onclick="checkDOMElements()">檢查 DOM 元素</button>
        <div id="dom-check" class="debug-output"></div>
    </div>
    
    <div class="debug-section">
        <div class="debug-title">🧪 組件初始化測試</div>
        <button class="test-btn" onclick="testMarketPageComponent()">測試 MarketPage 組件</button>
        <button class="test-btn" onclick="testCryptoCurrencyList()">測試 CryptoCurrencyList 組件</button>
        <div id="component-test" class="debug-output"></div>
    </div>
    
    <div class="debug-section">
        <div class="debug-title">📊 實際市場頁面測試</div>
        <div style="border: 1px solid var(--border-color); padding: 15px; border-radius: 8px;">
            <!-- 市場統計測試 -->
            <div id="test-market-stats" class="market-stats">
                <div class="market-stat">
                    <div class="stat-label">載入中...</div>
                    <div class="stat-value">-</div>
                </div>
            </div>
            
            <!-- 貨幣列表測試 -->
            <div style="margin-top: 20px;">
                <h4>貨幣列表測試</h4>
                <div id="test-market-coins-grid" class="crypto-list-container">
                    <div class="crypto-loading">
                        <div class="crypto-loading-spinner"></div>
                        <div class="crypto-loading-text">載入測試數據中...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 模組 -->
    <script src="/js/lib/api.js"></script>
    <script src="/js/components/CryptoCurrencyList.js"></script>
    <script src="/js/components/HomeCryptoList.js"></script>
    <script src="/js/components/MarketPage.js"></script>
    
    <script>
        // 檢查組件載入
        function checkComponents() {
            const output = document.getElementById('component-check');
            let result = '組件載入檢查結果：\n\n';
            
            const components = [
                'CryptoCurrencyList',
                'HomeCryptoList', 
                'MarketPage'
            ];
            
            components.forEach(comp => {
                if (typeof window[comp] !== 'undefined') {
                    result += `✅ ${comp}: 已載入\n`;
                } else {
                    result += `❌ ${comp}: 未載入\n`;
                }
            });
            
            output.textContent = result;
        }
        
        // 測試市場統計 API
        async function testMarketStats() {
            const output = document.getElementById('api-test');
            output.textContent = '測試市場統計 API...\n';
            
            try {
                const response = await fetch('/api/market/stats24h');
                const data = await response.json();
                output.textContent += '\n✅ 市場統計 API 回應：\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                output.textContent += '\n❌ 市場統計 API 錯誤：\n' + error.message;
            }
        }
        
        // 測試批量價格 API
        async function testBatchPrices() {
            const output = document.getElementById('api-test');
            output.textContent = '測試批量價格 API...\n';
            
            try {
                const response = await fetch('/api/market/batch-prices?symbols=BTCUSDT,ETHUSDT,BNBUSDT');
                const data = await response.json();
                output.textContent += '\n✅ 批量價格 API 回應：\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                output.textContent += '\n❌ 批量價格 API 錯誤：\n' + error.message;
            }
        }
        
        // 測試熱門交易對 API
        async function testTrendingPairs() {
            const output = document.getElementById('api-test');
            output.textContent = '測試熱門交易對 API...\n';
            
            try {
                const response = await fetch('/api/market/trending?limit=10');
                const data = await response.json();
                output.textContent += '\n✅ 熱門交易對 API 回應：\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                output.textContent += '\n❌ 熱門交易對 API 錯誤：\n' + error.message;
            }
        }
        
        // 檢查 DOM 元素
        function checkDOMElements() {
            const output = document.getElementById('dom-check');
            let result = 'DOM 元素檢查結果：\n\n';
            
            const elements = [
                'test-market-stats',
                'test-market-coins-grid'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    result += `✅ #${id}: 存在\n`;
                } else {
                    result += `❌ #${id}: 不存在\n`;
                }
            });
            
            output.textContent = result;
        }
        
        // 測試 MarketPage 組件
        function testMarketPageComponent() {
            const output = document.getElementById('component-test');
            output.textContent = '測試 MarketPage 組件...\n';
            
            try {
                if (typeof MarketPage === 'undefined') {
                    output.textContent += '❌ MarketPage 組件未載入\n';
                    return;
                }
                
                // 測試初始化
                const marketPage = new MarketPage();
                output.textContent += '✅ MarketPage 組件初始化成功\n';
                
                // 測試方法存在
                const methods = ['loadMarketStats', 'renderMarketStats', 'refresh'];
                methods.forEach(method => {
                    if (typeof marketPage[method] === 'function') {
                        output.textContent += `✅ 方法 ${method}: 存在\n`;
                    } else {
                        output.textContent += `❌ 方法 ${method}: 不存在\n`;
                    }
                });
                
            } catch (error) {
                output.textContent += '❌ MarketPage 組件測試失敗：\n' + error.message;
            }
        }
        
        // 測試 CryptoCurrencyList 組件
        function testCryptoCurrencyList() {
            const output = document.getElementById('component-test');
            output.textContent = '測試 CryptoCurrencyList 組件...\n';
            
            try {
                if (typeof CryptoCurrencyList === 'undefined') {
                    output.textContent += '❌ CryptoCurrencyList 組件未載入\n';
                    return;
                }
                
                const container = document.getElementById('test-market-coins-grid');
                if (!container) {
                    output.textContent += '❌ 測試容器不存在\n';
                    return;
                }
                
                // 測試初始化
                const cryptoList = new CryptoCurrencyList({
                    container: container,
                    mode: 'infinite',
                    maxCoins: 20,
                    coinsPerPage: 10,
                    updateInterval: 15000
                });
                
                output.textContent += '✅ CryptoCurrencyList 組件初始化成功\n';
                output.textContent += `✅ 容器: ${container.id}\n`;
                output.textContent += `✅ 模式: infinite\n`;
                output.textContent += `✅ 最大貨幣數: 20\n`;
                
            } catch (error) {
                output.textContent += '❌ CryptoCurrencyList 組件測試失敗：\n' + error.message + '\n' + error.stack;
            }
        }
        
        // 自動運行初始檢查
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                checkComponents();
                checkDOMElements();
            }, 500);
        });
    </script>
</body>
</html>