<!DOCTYPE html>
<html>
<head>
    <title>OAuth ç°¡å–®æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª OAuth ç™»å…¥ç‹€æ…‹æ¸¬è©¦</h1>
    
    <div class="section">
        <h3>æ¸¬è©¦æ­¥é©Ÿ</h3>
        <button onclick="simulateSuccessfulOAuth()">1. æ¨¡æ“¬æˆåŠŸ OAuth</button>
        <button onclick="checkLocalStorage()">2. æª¢æŸ¥ localStorage</button>
        <button onclick="clearAll()">3. æ¸…é™¤æ‰€æœ‰ç‹€æ…‹</button>
    </div>
    
    <div class="section">
        <h3>æ¸¬è©¦çµæœ</h3>
        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `section ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            results.appendChild(div);
            console.log(`[${type}] ${message}`);
        }

        function simulateSuccessfulOAuth() {
            log('ğŸ­ æ¨¡æ“¬æˆåŠŸçš„ OAuth å›èª¿æ•¸æ“š...', 'info');
            
            // æ¨¡æ“¬ OAuth æˆåŠŸå¾Œçš„æ•¸æ“š
            const tokenData = {
                token: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0LXVzZXItaWQiLCJuYW1lIjoiVGVzdCBVc2VyIiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXhwIjo5OTk5OTk5OTk5LCJpYXQiOjE2NDA5OTUyMDB9.test_signature',
                refreshToken: 'test_refresh_token_12345'
            };
            
            const userData = {
                id: 'test-user-id',
                name: 'Test User',
                email: 'test@example.com',
                avatar: 'https://via.placeholder.com/40',
                provider: 'google'
            };
            
            try {
                // ä¿å­˜åˆ° localStorage
                localStorage.setItem('nexustrade_token', tokenData.token);
                localStorage.setItem('nexustrade_refresh_token', tokenData.refreshToken);
                localStorage.setItem('nexustrade_user', JSON.stringify(userData));
                
                log('âœ… æˆåŠŸä¿å­˜ OAuth æ•¸æ“šåˆ° localStorage', 'success');
                log(`Token: ${tokenData.token.substring(0, 30)}...`, 'info');
                log(`User: ${userData.name} (${userData.email})`, 'info');
                
                // è§¸ç™¼é é¢åˆ·æ–°ä¾†æ¸¬è©¦æŒä¹…æ€§
                setTimeout(() => {
                    log('ğŸ”„ æ¸¬è©¦ç‹€æ…‹æŒä¹…æ€§ï¼Œæº–å‚™é‡æ–°è¼‰å…¥é é¢...', 'info');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                }, 1000);
                
            } catch (error) {
                log(`âŒ ä¿å­˜éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        function checkLocalStorage() {
            log('ğŸ” æª¢æŸ¥ç•¶å‰ localStorage ç‹€æ…‹...', 'info');
            
            const token = localStorage.getItem('nexustrade_token');
            const refreshToken = localStorage.getItem('nexustrade_refresh_token');
            const user = localStorage.getItem('nexustrade_user');
            
            if (token) {
                log(`âœ… Token å­˜åœ¨: ${token.substring(0, 30)}...`, 'success');
            } else {
                log('âŒ Token ä¸å­˜åœ¨', 'error');
            }
            
            if (refreshToken) {
                log(`âœ… Refresh Token å­˜åœ¨: ${refreshToken.substring(0, 20)}...`, 'success');
            } else {
                log('âŒ Refresh Token ä¸å­˜åœ¨', 'error');
            }
            
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    log(`âœ… ä½¿ç”¨è€…è³‡æ–™å­˜åœ¨: ${userData.name} (${userData.email})`, 'success');
                } catch (e) {
                    log(`âŒ ä½¿ç”¨è€…è³‡æ–™æ ¼å¼éŒ¯èª¤: ${e.message}`, 'error');
                }
            } else {
                log('âŒ ä½¿ç”¨è€…è³‡æ–™ä¸å­˜åœ¨', 'error');
            }
        }

        function clearAll() {
            log('ğŸ§¹ æ¸…é™¤æ‰€æœ‰èªè­‰ç‹€æ…‹...', 'info');
            localStorage.clear();
            document.getElementById('results').innerHTML = '';
            log('âœ… æ‰€æœ‰ç‹€æ…‹å·²æ¸…é™¤', 'success');
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥ç‹€æ…‹
        window.addEventListener('load', function() {
            log('ğŸ“„ é é¢è¼‰å…¥å®Œæˆï¼Œæª¢æŸ¥ç•¶å‰ç‹€æ…‹...', 'info');
            checkLocalStorage();
        });
    </script>
</body>
</html>