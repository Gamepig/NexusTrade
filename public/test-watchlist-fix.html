<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§€å¯Ÿæ¸…å–®åŠŸèƒ½ä¿®å¾©æ¸¬è©¦ - NexusTrade</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #0a0e17;
            color: #ffffff;
        }

        .section {
            background: #1a1d29;
            border: 1px solid #2d3748;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .section h2 {
            margin-top: 0;
            color: #4299e1;
            border-bottom: 2px solid #2d3748;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #68d391;
            margin-top: 24px;
        }

        .button {
            background: #3182ce;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background 0.2s;
        }

        .button:hover {
            background: #2c5aa0;
        }

        .button.success {
            background: #38a169;
        }

        .button.warning {
            background: #dd6b20;
        }

        .button.danger {
            background: #e53e3e;
        }

        .result {
            background: #2d3748;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .result.success {
            border-left-color: #38a169;
            background: #1a2f1a;
        }

        .result.error {
            border-left-color: #e53e3e;
            background: #2f1a1a;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background: #38a169;
        }

        .status-error {
            background: #e53e3e;
        }

        .status-warning {
            background: #dd6b20;
        }

        .test-step {
            margin: 15px 0;
            padding: 10px;
            background: #2d3748;
            border-radius: 6px;
        }

        .test-step .step-number {
            background: #4299e1;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .auth-info {
            background: #2d3748;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .auth-info h4 {
            margin-top: 0;
            color: #68d391;
        }

        .code-block {
            background: #1a202c;
            border: 1px solid #2d3748;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .alert.info {
            background: rgba(66, 153, 225, 0.1);
            border: 1px solid #4299e1;
            color: #4299e1;
        }

        .alert.warning {
            background: rgba(221, 107, 32, 0.1);
            border: 1px solid #dd6b20;
            color: #dd6b20;
        }

        .alert.success {
            background: rgba(56, 161, 105, 0.1);
            border: 1px solid #38a169;
            color: #38a169;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è§€å¯Ÿæ¸…å–®åŠŸèƒ½ä¿®å¾©æ¸¬è©¦</h1>
    
    <div class="alert info">
        <strong>â„¹ï¸ è¨ºæ–·èªªæ˜</strong><br>
        é€™å€‹é é¢å°‡å¹«åŠ©æ‚¨è¨ºæ–·å’Œä¿®å¾©è§€å¯Ÿæ¸…å–®åŠŸèƒ½çš„å•é¡Œï¼ŒåŒ…æ‹¬ã€ŒåŠ å…¥é—œæ³¨ã€æŒ‰éˆ•ç„¡åæ‡‰çš„æƒ…æ³ã€‚
    </div>

    <!-- ç¬¬ä¸€æ­¥ï¼šæª¢æŸ¥èªè­‰ç‹€æ…‹ -->
    <div class="section">
        <h2>ğŸ” ç¬¬ä¸€æ­¥ï¼šæª¢æŸ¥èªè­‰ç‹€æ…‹</h2>
        <p>é¦–å…ˆæª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æ­£ç¢ºç™»å…¥ä»¥åŠèªè­‰ç‹€æ…‹</p>
        
        <button class="button" onclick="checkAuthStatus()">ğŸ” æª¢æŸ¥èªè­‰ç‹€æ…‹</button>
        <button class="button warning" onclick="clearAuthData()">ğŸ§¹ æ¸…é™¤èªè­‰è³‡æ–™</button>
        <button class="button success" onclick="forceAuthSync()">ğŸš€ å¼·åˆ¶åŒæ­¥èªè­‰</button>
        
        <div id="auth-status-result" class="result" style="display: none;"></div>
        
        <div class="auth-info">
            <h4>ğŸ“‹ èªè­‰ç‹€æ…‹æª¢æŸ¥æ¸…å–®</h4>
            <ul>
                <li><span class="status-indicator" id="token-status"></span>JWT Token å­˜åœ¨ä¸”æœ‰æ•ˆ</li>
                <li><span class="status-indicator" id="user-status"></span>ç”¨æˆ¶è³‡æ–™å®Œæ•´</li>
                <li><span class="status-indicator" id="line-status"></span>LINE é€£æ¥ç‹€æ…‹</li>
                <li><span class="status-indicator" id="authmanager-status"></span>AuthManager é‹ä½œæ­£å¸¸</li>
            </ul>
        </div>
    </div>

    <!-- ç¬¬äºŒæ­¥ï¼šæ¸¬è©¦ API é€£æ¥ -->
    <div class="section">
        <h2>ğŸŒ ç¬¬äºŒæ­¥ï¼šæ¸¬è©¦ API é€£æ¥</h2>
        <p>æ¸¬è©¦è§€å¯Ÿæ¸…å–®ç›¸é—œçš„ API ç«¯é»æ˜¯å¦æ­£å¸¸é‹ä½œ</p>
        
        <button class="button" onclick="testWatchlistAPI()">ğŸ“¡ æ¸¬è©¦è§€å¯Ÿæ¸…å–® API</button>
        <button class="button" onclick="testAddToWatchlist()">â• æ¸¬è©¦æ·»åŠ åˆ°è§€å¯Ÿæ¸…å–®</button>
        <button class="button" onclick="testWatchlistStatus()">ğŸ” æ¸¬è©¦ç‹€æ…‹æª¢æŸ¥</button>
        
        <div id="api-test-result" class="result" style="display: none;"></div>
    </div>

    <!-- ç¬¬ä¸‰æ­¥ï¼šæ¨¡æ“¬æŒ‰éˆ•é»æ“Š -->
    <div class="section">
        <h2>ğŸ–±ï¸ ç¬¬ä¸‰æ­¥ï¼šæ¨¡æ“¬æŒ‰éˆ•åŠŸèƒ½</h2>
        <p>æ¨¡æ“¬è²¨å¹£è©³ç´°é é¢çš„ã€ŒåŠ å…¥é—œæ³¨ã€æŒ‰éˆ•åŠŸèƒ½</p>
        
        <div class="test-step">
            <span class="step-number">1</span>
            é¸æ“‡æ¸¬è©¦è²¨å¹£ï¼š
            <select id="test-symbol" style="margin-left: 10px; padding: 5px;">
                <option value="BTCUSDT">BTCUSDT (Bitcoin)</option>
                <option value="ETHUSDT">ETHUSDT (Ethereum)</option>
                <option value="BNBUSDT">BNBUSDT (BNB)</option>
                <option value="ADAUSDT">ADAUSDT (Cardano)</option>
            </select>
        </div>
        
        <button class="button" onclick="simulateAddToWatchlist()">â­ æ¨¡æ“¬åŠ å…¥é—œæ³¨</button>
        <button class="button" onclick="checkWatchlistStatus()">ğŸ“Š æª¢æŸ¥é—œæ³¨ç‹€æ…‹</button>
        <button class="button warning" onclick="removeFromWatchlist()">ğŸ—‘ï¸ ç§»é™¤é—œæ³¨</button>
        
        <div id="simulation-result" class="result" style="display: none;"></div>
    </div>

    <!-- ç¬¬å››æ­¥ï¼šå‰ç«¯äº‹ä»¶è¨ºæ–· -->
    <div class="section">
        <h2>ğŸ› ç¬¬å››æ­¥ï¼šå‰ç«¯äº‹ä»¶è¨ºæ–·</h2>
        <p>æª¢æŸ¥å‰ç«¯ JavaScript äº‹ä»¶ç¶å®šå’Œçµ„ä»¶ç‹€æ…‹</p>
        
        <button class="button" onclick="checkFrontendComponents()">ğŸ”§ æª¢æŸ¥å‰ç«¯çµ„ä»¶</button>
        <button class="button" onclick="checkEventBindings()">ğŸ¯ æª¢æŸ¥äº‹ä»¶ç¶å®š</button>
        <button class="button" onclick="testNavigationToDetailPage()">ğŸ§­ æ¸¬è©¦å°èˆªåˆ°è©³ç´°é é¢</button>
        
        <div id="frontend-check-result" class="result" style="display: none;"></div>
    </div>

    <!-- ä¿®å¾©å»ºè­° -->
    <div class="section">
        <h2>ğŸ› ï¸ ä¿®å¾©å»ºè­°</h2>
        <div id="fix-recommendations">
            <p>åŸ·è¡Œä¸Šè¿°æ¸¬è©¦å¾Œï¼Œé€™è£¡å°‡é¡¯ç¤ºå…·é«”çš„ä¿®å¾©å»ºè­°ã€‚</p>
        </div>
    </div>

    <script>
        let testResults = {
            auth: {},
            api: {},
            frontend: {}
        };

        // ç¬¬ä¸€æ­¥ï¼šæª¢æŸ¥èªè­‰ç‹€æ…‹
        async function checkAuthStatus() {
            const resultDiv = document.getElementById('auth-status-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'ğŸ” æª¢æŸ¥èªè­‰ç‹€æ…‹ä¸­...\n';

            try {
                // æª¢æŸ¥ localStorage ä¸­çš„èªè­‰è³‡æ–™
                const token = localStorage.getItem('nexustrade_token');
                const userStr = localStorage.getItem('nexustrade_user');
                const user = userStr ? JSON.parse(userStr) : null;

                let status = 'ğŸ“Š èªè­‰ç‹€æ…‹æª¢æŸ¥çµæœï¼š\n\n';

                // æª¢æŸ¥ Token
                if (token) {
                    try {
                        const payload = JSON.parse(atob(token.split('.')[1]));
                        const isExpired = payload.exp * 1000 <= Date.now();
                        
                        status += `âœ… JWT Token: å­˜åœ¨\n`;
                        status += `   - æœ‰æ•ˆæœŸé™: ${new Date(payload.exp * 1000).toLocaleString()}\n`;
                        status += `   - ç‹€æ…‹: ${isExpired ? 'âŒ å·²éæœŸ' : 'âœ… æœ‰æ•ˆ'}\n`;
                        
                        updateStatusIndicator('token-status', !isExpired);
                        testResults.auth.tokenValid = !isExpired;
                    } catch (e) {
                        status += `âŒ JWT Token: æ ¼å¼éŒ¯èª¤\n`;
                        updateStatusIndicator('token-status', false);
                        testResults.auth.tokenValid = false;
                    }
                } else {
                    status += `âŒ JWT Token: ä¸å­˜åœ¨\n`;
                    updateStatusIndicator('token-status', false);
                    testResults.auth.tokenValid = false;
                }

                // æª¢æŸ¥ç”¨æˆ¶è³‡æ–™
                if (user) {
                    status += `âœ… ç”¨æˆ¶è³‡æ–™: å­˜åœ¨\n`;
                    status += `   - ç”¨æˆ¶ ID: ${user.id || user._id || 'æœªçŸ¥'}\n`;
                    status += `   - é›»å­éƒµä»¶: ${user.email || 'æœªçŸ¥'}\n`;
                    status += `   - LINE ID: ${user.lineId || user.lineUserId || 'æœªè¨­å®š'}\n`;
                    status += `   - æä¾›è€…: ${user.provider || 'æœªçŸ¥'}\n`;
                    
                    updateStatusIndicator('user-status', true);
                    testResults.auth.userDataValid = true;
                } else {
                    status += `âŒ ç”¨æˆ¶è³‡æ–™: ä¸å­˜åœ¨\n`;
                    updateStatusIndicator('user-status', false);
                    testResults.auth.userDataValid = false;
                }

                // æª¢æŸ¥ LINE é€£æ¥ç‹€æ…‹
                const isLineConnected = !!(user?.lineUserId || user?.lineId || (user?.provider === 'line'));
                status += `${isLineConnected ? 'âœ…' : 'âš ï¸'} LINE é€£æ¥: ${isLineConnected ? 'å·²é€£æ¥' : 'æœªé€£æ¥'}\n`;
                updateStatusIndicator('line-status', isLineConnected);
                testResults.auth.lineConnected = isLineConnected;

                // æª¢æŸ¥ AuthManager
                const hasAuthManager = !!(window.authManager || window.authStateManager);
                status += `${hasAuthManager ? 'âœ…' : 'âŒ'} AuthManager: ${hasAuthManager ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥'}\n`;
                updateStatusIndicator('authmanager-status', hasAuthManager);
                testResults.auth.authManagerLoaded = hasAuthManager;

                if (hasAuthManager && window.authManager) {
                    status += `   - AuthManager é¡å‹: ${typeof window.authManager}\n`;
                    if (typeof window.authManager.isAuthenticated === 'function') {
                        const isAuth = window.authManager.isAuthenticated();
                        status += `   - èªè­‰ç‹€æ…‹: ${isAuth ? 'å·²èªè­‰' : 'æœªèªè­‰'}\n`;
                    }
                }

                resultDiv.textContent = status;
                resultDiv.className = 'result success';

            } catch (error) {
                resultDiv.textContent = `âŒ æª¢æŸ¥èªè­‰ç‹€æ…‹å¤±æ•—:\n${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        function updateStatusIndicator(id, isSuccess) {
            const indicator = document.getElementById(id);
            if (indicator) {
                indicator.className = `status-indicator ${isSuccess ? 'status-success' : 'status-error'}`;
            }
        }

        function clearAuthData() {
            localStorage.removeItem('nexustrade_token');
            localStorage.removeItem('nexustrade_user');
            sessionStorage.removeItem('nexustrade_token');
            sessionStorage.removeItem('nexustrade_user');
            
            alert('âœ… èªè­‰è³‡æ–™å·²æ¸…é™¤ï¼è«‹é‡æ–°ç™»å…¥ã€‚');
            checkAuthStatus();
        }

        async function forceAuthSync() {
            try {
                if (window.authStateManager && typeof window.authStateManager.forceAuthStateRefresh === 'function') {
                    await window.authStateManager.forceAuthStateRefresh();
                    alert('âœ… èªè­‰ç‹€æ…‹å·²å¼·åˆ¶åŒæ­¥ï¼');
                } else {
                    alert('âš ï¸ AuthStateManager ä¸å¯ç”¨ï¼Œè«‹é‡æ–°è¼‰å…¥é é¢');
                }
                checkAuthStatus();
            } catch (error) {
                alert(`âŒ å¼·åˆ¶åŒæ­¥å¤±æ•—: ${error.message}`);
            }
        }

        // ç¬¬äºŒæ­¥ï¼šæ¸¬è©¦ API é€£æ¥
        async function testWatchlistAPI() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'ğŸ” æ¸¬è©¦è§€å¯Ÿæ¸…å–® API...\n';

            const token = localStorage.getItem('nexustrade_token');
            if (!token) {
                resultDiv.textContent = 'âŒ æ²’æœ‰æ‰¾åˆ°èªè­‰ Tokenï¼Œè«‹å…ˆç™»å…¥';
                resultDiv.className = 'result error';
                return;
            }

            try {
                let results = 'ğŸ“¡ API æ¸¬è©¦çµæœï¼š\n\n';

                // æ¸¬è©¦ GET /api/watchlist
                const getResponse = await fetch('/api/watchlist', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                results += `GET /api/watchlist: ${getResponse.status}\n`;
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    results += `âœ… æˆåŠŸè¼‰å…¥è§€å¯Ÿæ¸…å–® (${data.data?.watchlist?.length || 0} é …ç›®)\n`;
                    testResults.api.getWatchlist = true;
                } else {
                    const errorData = await getResponse.json();
                    results += `âŒ å¤±æ•—: ${errorData.message || getResponse.statusText}\n`;
                    if (errorData.message && errorData.message.includes('ä½¿ç”¨è€…ä¸å­˜åœ¨')) {
                        results += `ğŸ¯ ç™¼ç¾å•é¡Œ: ç”¨æˆ¶åœ¨è³‡æ–™åº«ä¸­ä¸å­˜åœ¨ï¼\n`;
                    }
                    testResults.api.getWatchlist = false;
                }

                resultDiv.textContent = results;
                resultDiv.className = getResponse.ok ? 'result success' : 'result error';

            } catch (error) {
                resultDiv.textContent = `âŒ API æ¸¬è©¦å¤±æ•—:\n${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testAddToWatchlist() {
            const symbol = document.getElementById('test-symbol').value;
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.style.display = 'block';
            
            const token = localStorage.getItem('nexustrade_token');
            if (!token) {
                resultDiv.textContent = 'âŒ æ²’æœ‰æ‰¾åˆ°èªè­‰ Tokenï¼Œè«‹å…ˆç™»å…¥';
                resultDiv.className = 'result error';
                return;
            }

            try {
                resultDiv.textContent = `ğŸ” æ¸¬è©¦æ·»åŠ  ${symbol} åˆ°è§€å¯Ÿæ¸…å–®...\n`;

                const response = await fetch('/api/watchlist', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        symbol: symbol,
                        priority: 3,
                        category: 'default'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.textContent = `âœ… æˆåŠŸæ·»åŠ  ${symbol} åˆ°è§€å¯Ÿæ¸…å–®ï¼\n\nå›æ‡‰: ${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = 'result success';
                    testResults.api.addToWatchlist = true;
                } else {
                    resultDiv.textContent = `âŒ æ·»åŠ å¤±æ•— (HTTP ${response.status}):\n\n${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = 'result error';
                    testResults.api.addToWatchlist = false;
                    
                    if (data.message && data.message.includes('ä½¿ç”¨è€…ä¸å­˜åœ¨')) {
                        resultDiv.textContent += '\n\nğŸ¯ æ ¸å¿ƒå•é¡Œ: ä½¿ç”¨è€…åœ¨è³‡æ–™åº«ä¸­ä¸å­˜åœ¨ï¼';
                    }
                }

            } catch (error) {
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤:\n${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testWatchlistStatus() {
            const symbol = document.getElementById('test-symbol').value;
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.style.display = 'block';
            
            const token = localStorage.getItem('nexustrade_token');
            if (!token) {
                resultDiv.textContent = 'âŒ æ²’æœ‰æ‰¾åˆ°èªè­‰ Tokenï¼Œè«‹å…ˆç™»å…¥';
                resultDiv.className = 'result error';
                return;
            }

            try {
                resultDiv.textContent = `ğŸ” æª¢æŸ¥ ${symbol} çš„é—œæ³¨ç‹€æ…‹...\n`;

                const response = await fetch(`/api/watchlist/status/${symbol}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    const isWatched = data.data?.isWatched || false;
                    resultDiv.textContent = `âœ… ${symbol} é—œæ³¨ç‹€æ…‹: ${isWatched ? 'å·²é—œæ³¨' : 'æœªé—œæ³¨'}\n\nå›æ‡‰: ${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.textContent = `âŒ ç‹€æ…‹æª¢æŸ¥å¤±æ•— (HTTP ${response.status}):\n\n${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = 'result error';
                }

            } catch (error) {
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤:\n${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // ç¬¬ä¸‰æ­¥ï¼šæ¨¡æ“¬æŒ‰éˆ•åŠŸèƒ½
        function simulateAddToWatchlist() {
            testAddToWatchlist();
        }

        function checkWatchlistStatus() {
            testWatchlistStatus();
        }

        async function removeFromWatchlist() {
            const symbol = document.getElementById('test-symbol').value;
            const resultDiv = document.getElementById('simulation-result');
            resultDiv.style.display = 'block';
            
            const token = localStorage.getItem('nexustrade_token');
            if (!token) {
                resultDiv.textContent = 'âŒ æ²’æœ‰æ‰¾åˆ°èªè­‰ Tokenï¼Œè«‹å…ˆç™»å…¥';
                resultDiv.className = 'result error';
                return;
            }

            try {
                resultDiv.textContent = `ğŸ—‘ï¸ ç§»é™¤ ${symbol} å¾è§€å¯Ÿæ¸…å–®...\n`;

                const response = await fetch(`/api/watchlist/${symbol}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.textContent = `âœ… æˆåŠŸç§»é™¤ ${symbol}\n\nå›æ‡‰: ${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.textContent = `âŒ ç§»é™¤å¤±æ•— (HTTP ${response.status}):\n\n${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = 'result error';
                }

            } catch (error) {
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤:\n${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // ç¬¬å››æ­¥ï¼šæª¢æŸ¥å‰ç«¯çµ„ä»¶
        function checkFrontendComponents() {
            const resultDiv = document.getElementById('frontend-check-result');
            resultDiv.style.display = 'block';
            
            let results = 'ğŸ”§ å‰ç«¯çµ„ä»¶æª¢æŸ¥çµæœï¼š\n\n';

            // æª¢æŸ¥å…¨å±€çµ„ä»¶
            const components = [
                { name: 'CurrencyDetailPage', obj: window.CurrencyDetailPage },
                { name: 'WatchlistPage', obj: window.WatchlistPage },
                { name: 'PriceAlertModal', obj: window.PriceAlertModal },
                { name: 'priceAlertModal', obj: window.priceAlertModal },
                { name: 'AuthManager', obj: window.authManager },
                { name: 'AuthStateManager', obj: window.authStateManager },
                { name: 'Router', obj: window.router },
                { name: 'NexusTradeApp', obj: window.app }
            ];

            components.forEach(comp => {
                const exists = comp.obj !== undefined;
                results += `${exists ? 'âœ…' : 'âŒ'} ${comp.name}: ${exists ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥'}\n`;
                if (exists && typeof comp.obj === 'object') {
                    results += `   é¡å‹: ${typeof comp.obj}\n`;
                }
            });

            // æª¢æŸ¥è·¯ç”±ç‹€æ…‹
            results += '\nğŸ§­ è·¯ç”±ç‹€æ…‹:\n';
            results += `ç•¶å‰ hash: ${window.location.hash}\n`;
            results += `ç•¶å‰ pathname: ${window.location.pathname}\n`;

            resultDiv.textContent = results;
            resultDiv.className = 'result';
        }

        function checkEventBindings() {
            const resultDiv = document.getElementById('frontend-check-result');
            resultDiv.style.display = 'block';
            
            let results = 'ğŸ¯ äº‹ä»¶ç¶å®šæª¢æŸ¥çµæœï¼š\n\n';

            // æª¢æŸ¥è§€å¯Ÿæ¸…å–®æŒ‰éˆ•æ˜¯å¦å­˜åœ¨
            const watchlistBtn = document.getElementById('add-watchlist-btn');
            results += `${watchlistBtn ? 'âœ…' : 'âŒ'} add-watchlist-btn: ${watchlistBtn ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
            
            if (watchlistBtn) {
                const hasClickListener = watchlistBtn.onclick !== null || 
                                      watchlistBtn.getAttribute('onclick') !== null;
                results += `   é»æ“Šäº‹ä»¶: ${hasClickListener ? 'å·²ç¶å®š' : 'æœªç¶å®š'}\n`;
            }

            // æª¢æŸ¥è­¦å ±æŒ‰éˆ•
            const alertBtn = document.getElementById('set-alert-btn');
            results += `${alertBtn ? 'âœ…' : 'âŒ'} set-alert-btn: ${alertBtn ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;

            if (alertBtn) {
                const hasClickListener = alertBtn.onclick !== null || 
                                      alertBtn.getAttribute('onclick') !== null;
                results += `   é»æ“Šäº‹ä»¶: ${hasClickListener ? 'å·²ç¶å®š' : 'æœªç¶å®š'}\n`;
            }

            // æª¢æŸ¥æ˜¯å¦åœ¨è²¨å¹£è©³ç´°é é¢
            const currencyDetailPage = document.getElementById('currency-detail-page');
            results += `${currencyDetailPage ? 'âœ…' : 'âŒ'} currency-detail-page: ${currencyDetailPage ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;

            if (!watchlistBtn && !alertBtn) {
                results += '\nâš ï¸ å»ºè­°: æ‚¨å¯èƒ½ä¸åœ¨è²¨å¹£è©³ç´°é é¢ï¼Œè«‹å…ˆå°èˆªåˆ°è²¨å¹£é é¢\n';
            }

            resultDiv.textContent = results;
            resultDiv.className = 'result';
        }

        function testNavigationToDetailPage() {
            const symbol = document.getElementById('test-symbol').value;
            const resultDiv = document.getElementById('frontend-check-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = `ğŸ§­ å°èˆªåˆ° ${symbol} è©³ç´°é é¢...\nè«‹ç¨å€™...`;
            
            // å°èˆªåˆ°è²¨å¹£è©³ç´°é é¢
            window.location.hash = `#/currency/${symbol}`;
            
            setTimeout(() => {
                resultDiv.textContent += `\nâœ… å·²å°èˆªåˆ°: ${window.location.hash}\n`;
                resultDiv.textContent += `è«‹ç­‰å¾…é é¢è¼‰å…¥å®Œæˆå¾Œï¼Œå†æ¬¡æª¢æŸ¥äº‹ä»¶ç¶å®šã€‚`;
            }, 1000);
        }

        // åˆå§‹åŒ–æ™‚è‡ªå‹•åŸ·è¡Œèªè­‰æª¢æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkAuthStatus();
            }, 1000);
        });
    </script>
</body>
</html>