<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” åƒ¹æ ¼è­¦å ±æ–°å¢æŒ‰éˆ•è¨ºæ–·å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
        .console-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” åƒ¹æ ¼è­¦å ±æ–°å¢æŒ‰éˆ•è¨ºæ–·å·¥å…·</h1>
        <p>æª¢æŸ¥åƒ¹æ ¼è­¦å ±é é¢çš„æ–°å¢æŒ‰éˆ•ç„¡æ³•ä½¿ç”¨çš„å•é¡Œ</p>

        <!-- ç¬¬ä¸€æ­¥ï¼šèªè­‰è¨­ç½® -->
        <div class="test-section">
            <h3>ç¬¬ä¸€æ­¥ï¼šè¨­ç½®èªè­‰ç‹€æ…‹</h3>
            <button onclick="setupAuth()">ğŸ” è¨­ç½®æ¸¬è©¦èªè­‰</button>
            <button onclick="checkAuthStatus()">âœ… æª¢æŸ¥èªè­‰ç‹€æ…‹</button>
            <div id="auth-result" class="result" style="display: none;"></div>
        </div>

        <!-- ç¬¬äºŒæ­¥ï¼šæª¢æŸ¥ PriceAlertsPage çµ„ä»¶ -->
        <div class="test-section">
            <h3>ç¬¬äºŒæ­¥ï¼šæª¢æŸ¥ PriceAlertsPage çµ„ä»¶</h3>
            <button onclick="checkPriceAlertsPage()">ğŸ“Š æª¢æŸ¥çµ„ä»¶ç‹€æ…‹</button>
            <button onclick="initializePriceAlertsPage()">ğŸš€ åˆå§‹åŒ–çµ„ä»¶</button>
            <button onclick="renderPriceAlertsPage()">ğŸ¨ æ¸²æŸ“çµ„ä»¶</button>
            <div id="component-result" class="result" style="display: none;"></div>
        </div>

        <!-- ç¬¬ä¸‰æ­¥ï¼šæª¢æŸ¥ DOM å…ƒç´  -->
        <div class="test-section">
            <h3>ç¬¬ä¸‰æ­¥ï¼šæª¢æŸ¥ DOM å…ƒç´ </h3>
            <button onclick="checkDOMElements()">ğŸ” æª¢æŸ¥å¿…è¦å…ƒç´ </button>
            <button onclick="checkModalExists()">ğŸ“‹ æª¢æŸ¥æ¨¡æ…‹æ¡†</button>
            <button onclick="testAddButtonClick()">ğŸ–±ï¸ æ¸¬è©¦æ–°å¢æŒ‰éˆ•</button>
            <div id="dom-result" class="result" style="display: none;"></div>
        </div>

        <!-- ç¬¬å››æ­¥ï¼šæ‰‹å‹•æ¸¬è©¦æ–°å¢åŠŸèƒ½ -->
        <div class="test-section">
            <h3>ç¬¬å››æ­¥ï¼šæ‰‹å‹•æ¸¬è©¦æ–°å¢åŠŸèƒ½</h3>
            <button onclick="manualShowCreateModal()">ğŸ”” æ‰‹å‹•é¡¯ç¤ºå‰µå»ºæ¨¡æ…‹æ¡†</button>
            <button onclick="createTestAlert()">â• å‰µå»ºæ¸¬è©¦è­¦å ±</button>
            <div id="manual-result" class="result" style="display: none;"></div>
        </div>

        <!-- å³æ™‚æ§åˆ¶å°è¼¸å‡º -->
        <div class="test-section">
            <h3>å³æ™‚æ§åˆ¶å°è¼¸å‡º</h3>
            <button onclick="clearConsole()">ğŸ§¹ æ¸…ç©ºæ§åˆ¶å°</button>
            <div id="console-output" class="console-output"></div>
        </div>

        <!-- æ¸¬è©¦å®¹å™¨ -->
        <div class="test-section">
            <h3>æ¸¬è©¦å®¹å™¨</h3>
            <div id="test-container" style="border: 1px solid #ccc; min-height: 200px; padding: 20px;">
                <p>é€™è£¡å°‡é¡¯ç¤º PriceAlertsPage çš„æ¸²æŸ“çµæœ</p>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„çµ„ä»¶ -->
    <script src="/js/components/PriceAlertsPage.js"></script>

    <script>
        let consoleOutput = document.getElementById('console-output');
        let originalConsole = { ...console };
        let priceAlertsPageInstance = null;

        // åŠ«æŒ console è¼¸å‡º
        function interceptConsole() {
            ['log', 'error', 'warn', 'info'].forEach(method => {
                console[method] = function(...args) {
                    originalConsole[method].apply(console, args);
                    appendToConsole(`[${method.toUpperCase()}] ${args.join(' ')}`);
                };
            });
        }

        function appendToConsole(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            interceptConsole();
            appendToConsole('åƒ¹æ ¼è­¦å ±æ–°å¢æŒ‰éˆ•è¨ºæ–·å·¥å…·å·²æº–å‚™å°±ç·’');
        });

        // èªè­‰ç›¸é—œåŠŸèƒ½
        function setupAuth() {
            const mockToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ODY3YmM4NTJiODMxNmUwZDRiN2YyY2EiLCJlbWFpbCI6ImxpbmVfdWU1Y2MxODhlMWQyY2RiYWM1Y2ZkYTJhYmI2ZjZhMzRiQGV4YW1wbGUuY29tIiwibGluZUlkIjoiVWU1Y2MxODhlMWQyY2RiYWM1Y2ZkYTJhYmI2ZjZhMzRiIiwibGluZVVzZXJJZCI6IlVlNWNjMTg4ZTFkMmNkYmFjNWNmZGEyYWJiNmY2YTM0YiIsImdvb2dsZUlkIjpudWxsLCJwcm92aWRlciI6ImxpbmUiLCJtZW1iZXJzaGlwIjoiZnJlZSIsImlhdCI6MTc1MTY0Njg0NiwiZXhwIjoxNzUyMjUxNjQ2fQ.QEUm4SeOwkrXPikpyTQmqQbaHHXr_m50wug0Ri9iFng';
            const mockUser = {
                _id: '6867bc852b8316e0d4b7f2ca',
                email: 'line_ue5cc188e1d2cdbac5cfda2abb6f6a34b@example.com',
                googleId: null,
                lineId: 'Ue5cc188e1d2cdbac5cfda2abb6f6a34b',
                lineUserId: 'Ue5cc188e1d2cdbac5cfda2abb6f6a34b',
                provider: 'line',
                membership: 'free',
                status: 'active'
            };

            localStorage.setItem('nexustrade_token', mockToken);
            localStorage.setItem('nexustrade_user', JSON.stringify(mockUser));

            document.getElementById('auth-result').style.display = 'block';
            document.getElementById('auth-result').innerHTML = `âœ… èªè­‰è¨­ç½®æˆåŠŸï¼š
User ID: ${mockUser._id}
Provider: ${mockUser.provider}
Membership: ${mockUser.membership}`;

            appendToConsole('ğŸ” èªè­‰ç‹€æ…‹å·²è¨­ç½®');
        }

        function checkAuthStatus() {
            const token = localStorage.getItem('nexustrade_token');
            const user = localStorage.getItem('nexustrade_user');

            document.getElementById('auth-result').style.display = 'block';
            document.getElementById('auth-result').innerHTML = `èªè­‰ç‹€æ…‹æª¢æŸ¥ï¼š
Token å­˜åœ¨: ${!!token}
User å­˜åœ¨: ${!!user}
Token: ${token ? token.substring(0, 50) + '...' : 'ç„¡'}
User: ${user ? JSON.parse(user).email : 'ç„¡'}`;

            appendToConsole(`ğŸ” èªè­‰ç‹€æ…‹ - Token: ${!!token}, User: ${!!user}`);
        }

        // æª¢æŸ¥ PriceAlertsPage çµ„ä»¶
        function checkPriceAlertsPage() {
            appendToConsole('ğŸ“Š æª¢æŸ¥ PriceAlertsPage çµ„ä»¶...');

            const results = [];

            // æª¢æŸ¥çµ„ä»¶é¡åˆ¥æ˜¯å¦å­˜åœ¨
            if (typeof window.PriceAlertsPage !== 'undefined') {
                results.push('âœ… PriceAlertsPage é¡åˆ¥å·²è¼‰å…¥');
            } else {
                results.push('âŒ PriceAlertsPage é¡åˆ¥æœªè¼‰å…¥');
            }

            // æª¢æŸ¥å¯¦ä¾‹æ˜¯å¦å­˜åœ¨
            if (window.priceAlertsPage) {
                results.push('âœ… priceAlertsPage å¯¦ä¾‹å­˜åœ¨');
                results.push(`å¯¦ä¾‹é¡å‹: ${typeof window.priceAlertsPage}`);
            } else {
                results.push('âŒ priceAlertsPage å¯¦ä¾‹ä¸å­˜åœ¨');
            }

            document.getElementById('component-result').style.display = 'block';
            document.getElementById('component-result').innerHTML = results.join('\n');

            appendToConsole('ğŸ“Š PriceAlertsPage çµ„ä»¶æª¢æŸ¥å®Œæˆ');
        }

        function initializePriceAlertsPage() {
            appendToConsole('ğŸš€ åˆå§‹åŒ– PriceAlertsPage...');

            try {
                if (typeof window.PriceAlertsPage === 'undefined') {
                    throw new Error('PriceAlertsPage é¡åˆ¥æœªè¼‰å…¥');
                }

                // å‰µå»ºå¯¦ä¾‹
                priceAlertsPageInstance = new window.PriceAlertsPage();
                window.priceAlertsPage = priceAlertsPageInstance;

                // è¨­ç½®å®¹å™¨
                let container = document.getElementById('price-alerts-content');
                if (!container) {
                    container = document.createElement('div');
                    container.id = 'price-alerts-content';
                    document.getElementById('test-container').appendChild(container);
                    appendToConsole('ğŸ“¦ å‰µå»ºäº† price-alerts-content å®¹å™¨');
                }

                // åˆå§‹åŒ–
                priceAlertsPageInstance.init();

                document.getElementById('component-result').style.display = 'block';
                document.getElementById('component-result').innerHTML = `âœ… PriceAlertsPage åˆå§‹åŒ–æˆåŠŸ
å¯¦ä¾‹: ${typeof priceAlertsPageInstance}
å®¹å™¨: ${container ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}
è­¦å ±æ•¸é‡: ${priceAlertsPageInstance.alerts.length}`;

                appendToConsole('ğŸš€ PriceAlertsPage åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                appendToConsole(`âŒ åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
                document.getElementById('component-result').style.display = 'block';
                document.getElementById('component-result').innerHTML = `âŒ åˆå§‹åŒ–å¤±æ•—: ${error.message}`;
            }
        }

        function renderPriceAlertsPage() {
            appendToConsole('ğŸ¨ æ¸²æŸ“ PriceAlertsPage...');

            try {
                if (!priceAlertsPageInstance) {
                    throw new Error('è«‹å…ˆåˆå§‹åŒ– PriceAlertsPage');
                }

                priceAlertsPageInstance.render();

                document.getElementById('component-result').style.display = 'block';
                document.getElementById('component-result').innerHTML = `âœ… PriceAlertsPage æ¸²æŸ“å®Œæˆ
å®¹å™¨å…§å®¹é•·åº¦: ${document.getElementById('price-alerts-content')?.innerHTML.length || 0}`;

                appendToConsole('ğŸ¨ PriceAlertsPage æ¸²æŸ“å®Œæˆ');
            } catch (error) {
                appendToConsole(`âŒ æ¸²æŸ“å¤±æ•—: ${error.message}`);
                document.getElementById('component-result').style.display = 'block';
                document.getElementById('component-result').innerHTML = `âŒ æ¸²æŸ“å¤±æ•—: ${error.message}`;
            }
        }

        // æª¢æŸ¥ DOM å…ƒç´ 
        function checkDOMElements() {
            appendToConsole('ğŸ” æª¢æŸ¥å¿…è¦çš„ DOM å…ƒç´ ...');

            const elements = [
                'price-alerts-content',
                'add-alert-btn',
                'create-alert-modal',
                'create-alert-form'
            ];

            const results = [];

            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    results.push(`âœ… ${id}: å­˜åœ¨`);
                    if (id === 'add-alert-btn') {
                        results.push(`   - æŒ‰éˆ•æ–‡å­—: "${element.textContent.trim()}"`);
                        results.push(`   - æŒ‰éˆ•å¯è¦‹: ${element.offsetWidth > 0 && element.offsetHeight > 0}`);
                    }
                } else {
                    results.push(`âŒ ${id}: ä¸å­˜åœ¨`);
                }
            });

            document.getElementById('dom-result').style.display = 'block';
            document.getElementById('dom-result').innerHTML = results.join('\n');

            appendToConsole('ğŸ” DOM å…ƒç´ æª¢æŸ¥å®Œæˆ');
        }

        function checkModalExists() {
            appendToConsole('ğŸ“‹ æª¢æŸ¥æ¨¡æ…‹æ¡†æ˜¯å¦å­˜åœ¨...');

            const modal = document.getElementById('create-alert-modal');
            const results = [];

            if (modal) {
                results.push('âœ… create-alert-modal å­˜åœ¨');
                results.push(`   - é¡¯ç¤ºç‹€æ…‹: ${modal.style.display}`);
                results.push(`   - é¡åˆ¥: ${modal.className}`);
                results.push(`   - HTML é•·åº¦: ${modal.innerHTML.length}`);

                // æª¢æŸ¥è¡¨å–®
                const form = modal.querySelector('#create-alert-form');
                if (form) {
                    results.push('âœ… è¡¨å–®å­˜åœ¨');
                    results.push(`   - è¡¨å–®æ¬„ä½æ•¸: ${form.querySelectorAll('input, select, textarea').length}`);
                } else {
                    results.push('âŒ è¡¨å–®ä¸å­˜åœ¨');
                }
            } else {
                results.push('âŒ create-alert-modal ä¸å­˜åœ¨');
            }

            document.getElementById('dom-result').style.display = 'block';
            document.getElementById('dom-result').innerHTML = results.join('\n');

            appendToConsole('ğŸ“‹ æ¨¡æ…‹æ¡†æª¢æŸ¥å®Œæˆ');
        }

        function testAddButtonClick() {
            appendToConsole('ğŸ–±ï¸ æ¸¬è©¦æ–°å¢æŒ‰éˆ•é»æ“Š...');

            const button = document.getElementById('add-alert-btn');
            if (!button) {
                appendToConsole('âŒ æ–°å¢æŒ‰éˆ•ä¸å­˜åœ¨');
                document.getElementById('dom-result').style.display = 'block';
                document.getElementById('dom-result').innerHTML = 'âŒ add-alert-btn ä¸å­˜åœ¨ï¼Œç„¡æ³•æ¸¬è©¦';
                return;
            }

            // æ¨¡æ“¬é»æ“Šäº‹ä»¶
            const clickEvent = new Event('click', { bubbles: true });
            button.dispatchEvent(clickEvent);

            // æª¢æŸ¥æ¨¡æ…‹æ¡†æ˜¯å¦é¡¯ç¤º
            setTimeout(() => {
                const modal = document.getElementById('create-alert-modal');
                const isVisible = modal && (modal.style.display === 'flex' || modal.style.display === 'block');

                document.getElementById('dom-result').style.display = 'block';
                document.getElementById('dom-result').innerHTML = `æŒ‰éˆ•é»æ“Šæ¸¬è©¦çµæœ:
âœ… é»æ“Šäº‹ä»¶å·²è§¸ç™¼
æ¨¡æ…‹æ¡†é¡¯ç¤º: ${isVisible ? 'æ˜¯' : 'å¦'}
æ¨¡æ…‹æ¡†é¡¯ç¤ºæ¨£å¼: ${modal ? modal.style.display : 'N/A'}`;

                appendToConsole(`ğŸ–±ï¸ æŒ‰éˆ•é»æ“Šæ¸¬è©¦å®Œæˆ - æ¨¡æ…‹æ¡†é¡¯ç¤º: ${isVisible}`);
            }, 100);
        }

        // æ‰‹å‹•æ¸¬è©¦åŠŸèƒ½
        function manualShowCreateModal() {
            appendToConsole('ğŸ”” æ‰‹å‹•é¡¯ç¤ºå‰µå»ºæ¨¡æ…‹æ¡†...');

            try {
                if (priceAlertsPageInstance && typeof priceAlertsPageInstance.showCreateAlertModal === 'function') {
                    priceAlertsPageInstance.showCreateAlertModal();
                    appendToConsole('âœ… é€šéå¯¦ä¾‹æ–¹æ³•é¡¯ç¤ºæ¨¡æ…‹æ¡†');
                } else {
                    // ç›´æ¥æ“ä½œ DOM
                    const modal = document.getElementById('create-alert-modal');
                    if (modal) {
                        modal.style.display = 'flex';
                        appendToConsole('âœ… é€šé DOM æ“ä½œé¡¯ç¤ºæ¨¡æ…‹æ¡†');
                    } else {
                        appendToConsole('âŒ æ¨¡æ…‹æ¡†ä¸å­˜åœ¨ï¼Œç„¡æ³•é¡¯ç¤º');
                    }
                }

                document.getElementById('manual-result').style.display = 'block';
                document.getElementById('manual-result').innerHTML = `æ‰‹å‹•é¡¯ç¤ºæ¨¡æ…‹æ¡†çµæœ:
å¯¦ä¾‹æ–¹æ³•: ${priceAlertsPageInstance && typeof priceAlertsPageInstance.showCreateAlertModal === 'function' ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}
æ¨¡æ…‹æ¡†å…ƒç´ : ${document.getElementById('create-alert-modal') ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`;

            } catch (error) {
                appendToConsole(`âŒ æ‰‹å‹•é¡¯ç¤ºå¤±æ•—: ${error.message}`);
                document.getElementById('manual-result').style.display = 'block';
                document.getElementById('manual-result').innerHTML = `âŒ æ‰‹å‹•é¡¯ç¤ºå¤±æ•—: ${error.message}`;
            }
        }

        function createTestAlert() {
            appendToConsole('â• å‰µå»ºæ¸¬è©¦è­¦å ±...');

            if (!priceAlertsPageInstance) {
                appendToConsole('âŒ PriceAlertsPage å¯¦ä¾‹ä¸å­˜åœ¨');
                return;
            }

            const testAlertData = {
                symbol: 'TESTUSDT',
                alertType: 'price_above',
                targetPrice: 100,
                priority: 'medium',
                note: 'æ¸¬è©¦è­¦å ±',
                notificationMethods: {
                    lineNotify: { enabled: true }
                }
            };

            priceAlertsPageInstance.createAlert(testAlertData)
                .then(success => {
                    if (success) {
                        appendToConsole('âœ… æ¸¬è©¦è­¦å ±å‰µå»ºæˆåŠŸ');
                        document.getElementById('manual-result').style.display = 'block';
                        document.getElementById('manual-result').innerHTML = 'âœ… æ¸¬è©¦è­¦å ±å‰µå»ºæˆåŠŸ';
                    } else {
                        appendToConsole('âŒ æ¸¬è©¦è­¦å ±å‰µå»ºå¤±æ•—');
                        document.getElementById('manual-result').style.display = 'block';
                        document.getElementById('manual-result').innerHTML = 'âŒ æ¸¬è©¦è­¦å ±å‰µå»ºå¤±æ•—';
                    }
                })
                .catch(error => {
                    appendToConsole(`âŒ å‰µå»ºæ¸¬è©¦è­¦å ±éŒ¯èª¤: ${error.message}`);
                    document.getElementById('manual-result').style.display = 'block';
                    document.getElementById('manual-result').innerHTML = `âŒ å‰µå»ºéŒ¯èª¤: ${error.message}`;
                });
        }
    </script>
</body>
</html>