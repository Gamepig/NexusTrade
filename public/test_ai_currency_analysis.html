<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å–®ä¸€è²¨å¹£åˆ†ææ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .test-container {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .analysis-section {
            background: #3d3d3d;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .loading {
            text-align: center;
            color: #ffa502;
        }
        .error {
            color: #ff6b6b;
            background: #4a1f1f;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            color: #00d2d3;
        }
        button {
            background: #0088ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0066cc;
        }
        .json-output {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .indicator-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }
        .bullish { background-color: #00d2d3; color: #000; }
        .bearish { background-color: #ff6b6b; color: #fff; }
        .neutral { background-color: #ffa502; color: #000; }
        .hold { background-color: #0088ff; color: #fff; }
    </style>
</head>
<body>
    <h1>ğŸ¤– AI å–®ä¸€è²¨å¹£åˆ†ææ¸¬è©¦</h1>
    
    <div class="test-container">
        <h2>æ¸¬è©¦æ§åˆ¶</h2>
        <button onclick="testBTCAnalysis()">æ¸¬è©¦ BTC åˆ†æ</button>
        <button onclick="testETHAnalysis()">æ¸¬è©¦ ETH åˆ†æ</button>
        <button onclick="testDirectAPI()">ç›´æ¥ API æ¸¬è©¦</button>
        <button onclick="clearResults()">æ¸…é™¤çµæœ</button>
    </div>

    <div id="results"></div>

    <script>
        let testResults = [];

        async function testBTCAnalysis() {
            await testCurrencyAnalysis('BTCUSDT');
        }

        async function testETHAnalysis() {
            await testCurrencyAnalysis('ETHUSDT');
        }

        async function testCurrencyAnalysis(symbol) {
            const resultDiv = document.getElementById('results');
            const testContainer = document.createElement('div');
            testContainer.className = 'test-container';
            testContainer.innerHTML = `
                <h3>ğŸ“Š ${symbol} AI åˆ†ææ¸¬è©¦</h3>
                <div class="loading">ğŸ”„ è¼‰å…¥ä¸­...</div>
            `;
            resultDiv.appendChild(testContainer);

            try {
                console.log(`ğŸ” é–‹å§‹æ¸¬è©¦ ${symbol} AI åˆ†æ...`);
                
                const response = await fetch(`/api/ai/currency-analysis/${symbol}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    testContainer.innerHTML = generateAnalysisHTML(symbol, data.data);
                    testResults.push({
                        symbol,
                        status: 'success',
                        data: data.data,
                        timestamp: new Date().toISOString()
                    });
                } else {
                    throw new Error(data.message || 'åˆ†æå¤±æ•—');
                }
                
            } catch (error) {
                console.error(`âŒ ${symbol} åˆ†ææ¸¬è©¦å¤±æ•—:`, error);
                testContainer.innerHTML = `
                    <h3>âŒ ${symbol} åˆ†æå¤±æ•—</h3>
                    <div class="error">éŒ¯èª¤: ${error.message}</div>
                `;
                testResults.push({
                    symbol,
                    status: 'error',
                    error: error.message,
                    timestamp: new Date().toISOString()
                });
            }
        }

        function generateAnalysisHTML(symbol, analysisData) {
            const analysis = analysisData.analysis;
            
            return `
                <h3>âœ… ${symbol} AI åˆ†æçµæœ</h3>
                
                <div class="analysis-section">
                    <h4>ğŸ“ˆ è¶¨å‹¢åˆ†æ</h4>
                    <p><strong>æ–¹å‘:</strong> <span class="indicator-tag ${analysis.trend.direction}">${getTrendText(analysis.trend.direction)}</span></p>
                    <p><strong>ä¿¡å¿ƒåº¦:</strong> ${analysis.trend.confidence}%</p>
                    <p><strong>æ‘˜è¦:</strong> ${analysis.trend.summary}</p>
                </div>

                <div class="analysis-section">
                    <h4>ğŸ“Š æŠ€è¡“æŒ‡æ¨™åˆ†æ</h4>
                    ${generateTechnicalIndicatorsHTML(analysis.technicalAnalysis)}
                </div>

                <div class="analysis-section">
                    <h4>ğŸ’­ å¸‚å ´æƒ…ç·’</h4>
                    <p><strong>è©•åˆ†:</strong> ${analysis.marketSentiment.score}/100</p>
                    <p><strong>æ¨™ç±¤:</strong> <span class="indicator-tag ${analysis.marketSentiment.label}">${getSentimentText(analysis.marketSentiment.label)}</span></p>
                    <p><strong>æ‘˜è¦:</strong> ${analysis.marketSentiment.summary}</p>
                </div>

                <div class="analysis-section">
                    <h4>ğŸ“‹ åˆ†æè©³æƒ…</h4>
                    <p><strong>åˆ†ææ—¥æœŸ:</strong> ${analysisData.analysisDate}</p>
                    <p><strong>æ•¸æ“šä¾†æº:</strong> ${analysisData.dataSources.analysisModel}</p>
                    <p><strong>è™•ç†æ™‚é–“:</strong> ${analysisData.qualityMetrics.processingTime}ms</p>
                    <p><strong>æ•¸æ“šå®Œæ•´æ€§:</strong> ${analysisData.qualityMetrics.dataCompleteness}%</p>
                    <p><strong>æ˜¯å¦å¿«å–:</strong> ${analysisData.isFromCache ? 'æ˜¯' : 'å¦'}</p>
                </div>

                <details>
                    <summary>ğŸ“ å®Œæ•´ JSON å›æ‡‰</summary>
                    <div class="json-output">${JSON.stringify(analysisData, null, 2)}</div>
                </details>
            `;
        }

        function generateTechnicalIndicatorsHTML(technical) {
            let html = '';
            
            for (const [indicator, data] of Object.entries(technical)) {
                if (data && typeof data === 'object' && data.signal) {
                    html += `
                        <p><strong>${getIndicatorName(indicator)}:</strong> 
                        <span class="indicator-tag ${getSignalClass(data.signal)}">${data.signal}</span>
                        ${data.interpretation ? `- ${data.interpretation}` : ''}
                        ${data.value !== undefined ? ` (å€¼: ${data.value})` : ''}
                        </p>
                    `;
                }
            }
            
            return html || '<p>æŠ€è¡“æŒ‡æ¨™æ•¸æ“šä¸å¯ç”¨</p>';
        }

        function getSignalClass(signal) {
            if (signal.includes('çœ‹æ¼²') || signal.includes('è²·å…¥')) return 'bullish';
            if (signal.includes('çœ‹è·Œ') || signal.includes('è³£å‡º')) return 'bearish';
            if (signal.includes('ä¸­æ€§')) return 'neutral';
            return 'hold';
        }

        function getTrendText(trend) {
            const trendMap = {
                'bullish': 'çœ‹æ¼²',
                'bearish': 'çœ‹è·Œ',
                'neutral': 'ä¸­æ€§'
            };
            return trendMap[trend] || trend;
        }

        function getSentimentText(sentiment) {
            const sentimentMap = {
                'positive': 'ç©æ¥µ',
                'negative': 'æ¶ˆæ¥µ',
                'neutral': 'ä¸­æ€§'
            };
            return sentimentMap[sentiment] || sentiment;
        }

        function getIndicatorName(indicator) {
            const indicatorMap = {
                'rsi': 'RSI',
                'macd': 'MACD',
                'movingAverage': 'ç§»å‹•å¹³å‡ç·š',
                'bollingerBands': 'å¸ƒæ—å¸¶',
                'volume': 'æˆäº¤é‡'
            };
            return indicatorMap[indicator] || indicator;
        }

        async function testDirectAPI() {
            const resultDiv = document.getElementById('results');
            const testContainer = document.createElement('div');
            testContainer.className = 'test-container';
            testContainer.innerHTML = `
                <h3>ğŸ”§ ç›´æ¥ API æ¸¬è©¦</h3>
                <div class="loading">ğŸ”„ æ¸¬è©¦ä¸­...</div>
            `;
            resultDiv.appendChild(testContainer);

            try {
                // æ¸¬è©¦ AI æœå‹™ç‹€æ…‹
                const statusResponse = await fetch('/api/ai/status');
                const statusData = await statusResponse.json();
                
                let html = `
                    <h3>ğŸ”§ API æ¸¬è©¦çµæœ</h3>
                    <div class="analysis-section">
                        <h4>ğŸ¥ AI æœå‹™ç‹€æ…‹</h4>
                        <div class="json-output">${JSON.stringify(statusData, null, 2)}</div>
                    </div>
                `;

                // æ¸¬è©¦è²¨å¹£åˆ†æ API
                const btcResponse = await fetch('/api/ai/currency-analysis/BTCUSDT');
                const btcData = await btcResponse.json();
                
                html += `
                    <div class="analysis-section">
                        <h4>ğŸ“Š BTC åˆ†æ API å›æ‡‰</h4>
                        <div class="json-output">${JSON.stringify(btcData, null, 2)}</div>
                    </div>
                `;

                testContainer.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ ç›´æ¥ API æ¸¬è©¦å¤±æ•—:', error);
                testContainer.innerHTML = `
                    <h3>âŒ API æ¸¬è©¦å¤±æ•—</h3>
                    <div class="error">éŒ¯èª¤: ${error.message}</div>
                `;
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testResults = [];
            console.log('ğŸ§¹ æ¸¬è©¦çµæœå·²æ¸…é™¤');
        }

        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºæ­¡è¿è¨Šæ¯
        window.addEventListener('load', () => {
            console.log('ğŸ¤– AI å–®ä¸€è²¨å¹£åˆ†ææ¸¬è©¦é é¢å·²è¼‰å…¥');
            console.log('è«‹é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦ AI åˆ†æåŠŸèƒ½');
        });
    </script>
</body>
</html>