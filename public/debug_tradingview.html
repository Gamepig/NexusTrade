<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView é™¤éŒ¯</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #000; 
            color: white; 
            padding: 20px; 
        }
        .debug-info { 
            background: #222; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border: 1px solid #444; 
        }
        .error { background: #420; border-color: #f44; }
        .success { background: #042; border-color: #4f4; }
        .warning { background: #440; border-color: #ff4; }
        
        .chart-container {
            height: 200px;
            background: #111;
            margin: 20px 0;
            border: 2px solid #333;
            position: relative;
        }
        .tradingview-widget-container {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>ğŸ” TradingView é™¤éŒ¯è¨ºæ–·</h1>
    
    <div id="console-logs" class="debug-info">
        <h3>ğŸ“ æ§åˆ¶å°æ—¥èªŒ</h3>
        <div id="log-output"></div>
    </div>
    
    <div id="script-status" class="debug-info">
        <h3>ğŸ“œ è…³æœ¬è¼‰å…¥ç‹€æ…‹</h3>
        <div id="script-output">æª¢æŸ¥ä¸­...</div>
    </div>
    
    <div id="widget-status" class="debug-info">
        <h3>ğŸ“Š å°å·¥å…·ç‹€æ…‹</h3>
        <div id="widget-output">ç­‰å¾…è¼‰å…¥...</div>
    </div>
    
    <h2>ğŸ§ª TradingView å°å·¥å…·æ¸¬è©¦</h2>
    <div class="chart-container">
        <!-- TradingView Widget BEGIN -->
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright">
                <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
                    <span class="blue-text">Track all markets on TradingView</span>
                </a>
            </div>
        </div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
        {
          "symbol": "BINANCE:BTCUSDT",
          "width": "100%",
          "height": "200",
          "locale": "zh_TW",
          "dateRange": "1D",
          "colorTheme": "dark",
          "isTransparent": true,
          "autosize": true,
          "largeChartUrl": ""
        }
        </script>
        <!-- TradingView Widget END -->
    </div>
    
    <script>
        // æ””æˆªæ§åˆ¶å°è¼¸å‡º
        const logOutput = document.getElementById('log-output');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(type, message) {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? '#f44' : type === 'warn' ? '#fa4' : '#4f4';
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${type.toUpperCase()}: ${message}`;
            logOutput.appendChild(div);
        }
        
        console.log = function(...args) {
            addLog('log', args.join(' '));
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addLog('error', args.join(' '));
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            addLog('warn', args.join(' '));
            originalWarn.apply(console, args);
        };
        
        // æª¢æŸ¥è…³æœ¬è¼‰å…¥
        const scriptOutput = document.getElementById('script-output');
        const widgetOutput = document.getElementById('widget-output');
        
        // è…³æœ¬è¼‰å…¥æª¢æ¸¬
        const scripts = document.querySelectorAll('script[src*="tradingview"]');
        if (scripts.length > 0) {
            scriptOutput.innerHTML = `âœ… æ‰¾åˆ° ${scripts.length} å€‹ TradingView è…³æœ¬`;
            
            scripts.forEach((script, index) => {
                script.onload = function() {
                    addLog('log', `TradingView è…³æœ¬ ${index + 1} è¼‰å…¥æˆåŠŸ`);
                };
                
                script.onerror = function() {
                    addLog('error', `TradingView è…³æœ¬ ${index + 1} è¼‰å…¥å¤±æ•—`);
                };
            });
        } else {
            scriptOutput.innerHTML = `âŒ æœªæ‰¾åˆ° TradingView è…³æœ¬`;
        }
        
        // å°å·¥å…·æª¢æ¸¬
        let checkCount = 0;
        const maxChecks = 30;
        
        function checkWidget() {
            const widgets = document.querySelectorAll('.tradingview-widget-container__widget');
            let loadedCount = 0;
            
            widgets.forEach(widget => {
                if (widget.hasChildNodes() && widget.children.length > 0) {
                    loadedCount++;
                }
            });
            
            if (loadedCount > 0) {
                widgetOutput.innerHTML = `âœ… ${loadedCount}/${widgets.length} å€‹å°å·¥å…·è¼‰å…¥æˆåŠŸ`;
                addLog('log', `TradingView å°å·¥å…·è¼‰å…¥æˆåŠŸ (${loadedCount}/${widgets.length})`);
            } else if (checkCount >= maxChecks) {
                widgetOutput.innerHTML = `âŒ å°å·¥å…·è¼‰å…¥è¶…æ™‚ (æª¢æŸ¥äº† ${checkCount} æ¬¡)`;
                addLog('error', 'TradingView å°å·¥å…·è¼‰å…¥è¶…æ™‚');
            } else {
                widgetOutput.innerHTML = `â³ æª¢æŸ¥ä¸­... (${checkCount + 1}/${maxChecks})`;
                checkCount++;
                setTimeout(checkWidget, 1000);
            }
        }
        
        // é–‹å§‹æª¢æŸ¥
        setTimeout(checkWidget, 2000);
        
        // CSP éŒ¯èª¤æª¢æ¸¬
        document.addEventListener('securitypolicyviolation', function(e) {
            addLog('error', `CSP é•è¦: ${e.blockedURI} - ${e.violatedDirective}`);
        });
        
        // ç¶²è·¯éŒ¯èª¤æª¢æ¸¬
        window.addEventListener('error', function(e) {
            if (e.target && e.target.tagName === 'SCRIPT') {
                addLog('error', `è…³æœ¬è¼‰å…¥éŒ¯èª¤: ${e.target.src}`);
            }
        });
        
        // åˆå§‹æ—¥èªŒ
        addLog('log', 'é™¤éŒ¯é é¢åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>