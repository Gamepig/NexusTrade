<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完整首頁測試</title>
    <link rel="stylesheet" href="/css/main.css">
    <style>
        .force-visible {
            display: block !important;
            visibility: visible !important;
        }
        .debug-banner {
            background: #f7931a;
            color: black;
            text-align: center;
            padding: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="debug-banner">🧪 完整首頁測試 - 強制顯示所有組件</div>
    
    <div class="app force-visible">
        <!-- 頂部導航 -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <span class="logo-icon">₿</span>
                        <span class="logo-text">NexusTrade</span>
                    </div>
                    
                    <nav class="nav">
                        <ul class="nav-list">
                            <li><a href="#dashboard" class="nav-link active">首頁</a></li>
                            <li><a href="#market" class="nav-link">市場</a></li>
                            <li><a href="#news" class="nav-link">新聞</a></li>
                            <li><a href="#watchlist" class="nav-link">關注</a></li>
                            <li><a href="#notifications" class="nav-link">通知</a></li>
                            <li><a href="#ai-insights" class="nav-link">AI 分析</a></li>
                        </ul>
                    </nav>
                    
                    <div class="header-actions">
                        <button class="btn btn-secondary">登入</button>
                        <button class="btn btn-primary">註冊</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- 新聞跑馬燈 -->
        <div class="news-ticker-section">
            <div class="container">
                <div id="news-ticker">
                    <div class="news-ticker-wrapper">
                        <div class="news-ticker-label">
                            <i class="news-icon">📰</i>
                            <span>最新消息</span>
                        </div>
                        <div class="news-ticker-content">
                            <div class="news-ticker-track">
                                <div class="news-ticker-item">測試新聞：Bitcoin 價格更新...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主要內容區域 -->
        <main class="main">
            <div class="container">
                <section class="page active">
                    <div class="homepage-container">
                        <!-- TradingView 圖表區 -->
                        <section class="section-main-charts">
                            <div class="section-header">
                                <h2>主要加密貨幣</h2>
                            </div>
                            <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center; color: #aaa; margin-bottom: 20px;">
                                TradingView 圖表區域 (省略以專注於列表測試)
                            </div>
                        </section>

                        <!-- AI 分析區 -->
                        <section class="section-ai-insights">
                            <div class="section-header">
                                <h2>AI 市場趨勢分析</h2>
                                <span class="status-badge">即將推出</span>
                            </div>
                            <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center; color: #aaa; margin-bottom: 20px;">
                                AI 分析區域 (省略以專注於列表測試)
                            </div>
                        </section>

                        <!-- 市場焦點 -->
                        <section class="section-news-highlights">
                            <div class="section-header">
                                <h2>市場焦點</h2>
                            </div>
                            <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center; color: #aaa; margin-bottom: 20px;">
                                新聞焦點區域 (省略以專注於列表測試)
                            </div>
                        </section>

                        <!-- 🎯 重點：熱門貨幣列表 -->
                        <section class="section-trending-coins">
                            <div class="section-header">
                                <h2>熱門貨幣</h2>
                                <span class="subtitle">精選 10 種主流加密貨幣，每 10 秒更新</span>
                            </div>
                            <div class="trending-coins-container">
                                <div class="coins-table">
                                    <div class="table-header">
                                        <div class="col-coin">貨幣</div>
                                        <div class="col-price">價格</div>
                                        <div class="col-change">24h 變化</div>
                                        <div class="col-change-amount">漲跌點數</div>
                                        <div class="col-volume">24h 交易量</div>
                                        <div class="col-market-cap">市值</div>
                                    </div>
                                    <div class="table-body" id="trending-coins-list">
                                        <div class="loading-row">
                                            <div class="loading-spinner"></div>
                                            <span>強制載入熱門貨幣中...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- JavaScript 模組 -->
    <script src="/js/crypto-icons-map.js"></script>
    <script src="/js/lib/api.js"></script>
    <script src="/js/lib/dom.js"></script>
    <script src="/js/lib/router.js"></script>
    <script src="/js/state/store.js"></script>
    <script src="/js/components/Notification.js"></script>
    <script src="/js/components/CryptoCurrencyList.js"></script>
    <script src="/js/components/HomeCryptoList.js"></script>
    <script src="/js/components/NewsTicker.js"></script>

    <script>
        // 強制初始化熱門貨幣列表
        async function forceInitCoinsList() {
            console.log('🎯 強制初始化熱門貨幣列表...');
            
            const container = document.getElementById('trending-coins-list');
            if (!container) {
                console.error('❌ 找不到容器');
                return;
            }

            try {
                // 檢查組件是否載入
                console.log('CryptoCurrencyList:', typeof CryptoCurrencyList);
                console.log('HomeCryptoList:', typeof HomeCryptoList);
                console.log('getCryptoIcon:', typeof window.getCryptoIcon);

                // 方法1: 使用 HomeCryptoList
                if (typeof HomeCryptoList !== 'undefined') {
                    console.log('📦 使用 HomeCryptoList 初始化...');
                    const homeCrypto = new HomeCryptoList();
                    
                    setTimeout(() => {
                        console.log('檢查 HomeCryptoList 結果...');
                        console.log('容器內容:', container.innerHTML.substring(0, 200));
                    }, 3000);
                }

                // 方法2: 使用 CryptoCurrencyList (備用)
                setTimeout(() => {
                    if (container.innerHTML.includes('載入中') || container.innerHTML.includes('強制載入')) {
                        console.log('🔄 HomeCryptoList 未成功，嘗試 CryptoCurrencyList...');
                        
                        if (typeof CryptoCurrencyList !== 'undefined') {
                            const cryptoList = new CryptoCurrencyList({
                                container: container,
                                mode: 'fixed',
                                maxCoins: 10,
                                coinsPerPage: 10,
                                updateInterval: 10000
                            });
                        }
                    }
                }, 5000);

                // 方法3: 手動載入數據 (最終備用)
                setTimeout(() => {
                    if (container.innerHTML.includes('載入中') || container.innerHTML.includes('強制載入')) {
                        console.log('🔧 自動載入失敗，手動載入數據...');
                        manualLoadCoins();
                    }
                }, 8000);

            } catch (error) {
                console.error('❌ 初始化錯誤:', error);
                setTimeout(() => manualLoadCoins(), 2000);
            }
        }

        // 手動載入貨幣數據
        async function manualLoadCoins() {
            console.log('🔧 手動載入貨幣數據...');
            
            const container = document.getElementById('trending-coins-list');
            
            try {
                const response = await fetch('/api/market/trending?limit=10');
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || '獲取數據失敗');
                }

                const coins = result.data;
                let html = '';

                coins.forEach((coin, index) => {
                    const changePercent = parseFloat(coin.priceChangePercent || 0);
                    const changeAmount = parseFloat(coin.priceChange || 0);
                    const isPositive = changePercent >= 0;
                    const baseCoin = coin.symbol.replace('USDT', '');
                    
                    // 模擬市值
                    const simulatedSupply = {
                        'BTC': 19700000, 'ETH': 120000000, 'USDC': 35000000000,
                        'SOL': 470000000, 'FDUSD': 10000000000
                    };
                    const supply = simulatedSupply[baseCoin] || 1000000000;
                    const marketCap = coin.price * supply;
                    
                    function formatNumber(value) {
                        if (value >= 1e12) return `$${(value/1e12).toFixed(2)}T`;
                        if (value >= 1e9) return `$${(value/1e9).toFixed(2)}B`;
                        if (value >= 1e6) return `$${(value/1e6).toFixed(2)}M`;
                        return `$${value.toFixed(2)}`;
                    }
                    
                    // 獲取圖標
                    const iconHtml = window.getCryptoIcon ? window.getCryptoIcon(coin.symbol, 32) : 
                        `<div style="width: 32px; height: 32px; background: #666; color: white; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; font-size: 12px;">${baseCoin.substring(0, 3)}</div>`;
                    
                    html += `
                        <div class="coin-row">
                            <div class="col-coin">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    ${iconHtml}
                                    <div>
                                        <div style="font-weight: bold;">${baseCoin}</div>
                                        <div style="font-size: 0.8em; color: #aaa;">${coin.name}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-price">$${parseFloat(coin.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 6})}</div>
                            <div class="col-change" style="color: ${isPositive ? '#00d4aa' : '#ff4757'};">${changePercent.toFixed(2)}%</div>
                            <div class="col-change-amount" style="color: ${isPositive ? '#00d4aa' : '#ff4757'};">${isPositive ? '+' : ''}$${Math.abs(changeAmount).toFixed(4)}</div>
                            <div class="col-volume">${formatNumber(coin.quoteVolume)}</div>
                            <div class="col-market-cap">${formatNumber(marketCap)}</div>
                        </div>
                    `;
                });

                container.innerHTML = html;
                console.log('✅ 手動載入成功！');

            } catch (error) {
                console.error('❌ 手動載入失敗:', error);
                container.innerHTML = `<div style="padding: 20px; text-align: center; color: #ff4757;">載入失敗: ${error.message}</div>`;
            }
        }

        // 頁面載入完成後執行
        window.addEventListener('load', () => {
            console.log('🧪 完整首頁測試開始...');
            
            setTimeout(() => {
                forceInitCoinsList();
            }, 1000);
        });
    </script>
</body>
</html>