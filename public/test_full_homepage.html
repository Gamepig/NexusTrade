<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´é¦–é æ¸¬è©¦</title>
    <link rel="stylesheet" href="/css/main.css">
    <style>
        .force-visible {
            display: block !important;
            visibility: visible !important;
        }
        .debug-banner {
            background: #f7931a;
            color: black;
            text-align: center;
            padding: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="debug-banner">ğŸ§ª å®Œæ•´é¦–é æ¸¬è©¦ - å¼·åˆ¶é¡¯ç¤ºæ‰€æœ‰çµ„ä»¶</div>
    
    <div class="app force-visible">
        <!-- é ‚éƒ¨å°èˆª -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <span class="logo-icon">â‚¿</span>
                        <span class="logo-text">NexusTrade</span>
                    </div>
                    
                    <nav class="nav">
                        <ul class="nav-list">
                            <li><a href="#dashboard" class="nav-link active">é¦–é </a></li>
                            <li><a href="#market" class="nav-link">å¸‚å ´</a></li>
                            <li><a href="#news" class="nav-link">æ–°è</a></li>
                            <li><a href="#watchlist" class="nav-link">é—œæ³¨</a></li>
                            <li><a href="#notifications" class="nav-link">é€šçŸ¥</a></li>
                            <li><a href="#ai-insights" class="nav-link">AI åˆ†æ</a></li>
                        </ul>
                    </nav>
                    
                    <div class="header-actions">
                        <button class="btn btn-secondary">ç™»å…¥</button>
                        <button class="btn btn-primary">è¨»å†Š</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- æ–°èè·‘é¦¬ç‡ˆ -->
        <div class="news-ticker-section">
            <div class="container">
                <div id="news-ticker">
                    <div class="news-ticker-wrapper">
                        <div class="news-ticker-label">
                            <i class="news-icon">ğŸ“°</i>
                            <span>æœ€æ–°æ¶ˆæ¯</span>
                        </div>
                        <div class="news-ticker-content">
                            <div class="news-ticker-track">
                                <div class="news-ticker-item">æ¸¬è©¦æ–°èï¼šBitcoin åƒ¹æ ¼æ›´æ–°...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
        <main class="main">
            <div class="container">
                <section class="page active">
                    <div class="homepage-container">
                        <!-- TradingView åœ–è¡¨å€ -->
                        <section class="section-main-charts">
                            <div class="section-header">
                                <h2>ä¸»è¦åŠ å¯†è²¨å¹£</h2>
                            </div>
                            <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center; color: #aaa; margin-bottom: 20px;">
                                TradingView åœ–è¡¨å€åŸŸ (çœç•¥ä»¥å°ˆæ³¨æ–¼åˆ—è¡¨æ¸¬è©¦)
                            </div>
                        </section>

                        <!-- AI åˆ†æå€ -->
                        <section class="section-ai-insights">
                            <div class="section-header">
                                <h2>AI å¸‚å ´è¶¨å‹¢åˆ†æ</h2>
                                <span class="status-badge">å³å°‡æ¨å‡º</span>
                            </div>
                            <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center; color: #aaa; margin-bottom: 20px;">
                                AI åˆ†æå€åŸŸ (çœç•¥ä»¥å°ˆæ³¨æ–¼åˆ—è¡¨æ¸¬è©¦)
                            </div>
                        </section>

                        <!-- å¸‚å ´ç„¦é» -->
                        <section class="section-news-highlights">
                            <div class="section-header">
                                <h2>å¸‚å ´ç„¦é»</h2>
                            </div>
                            <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center; color: #aaa; margin-bottom: 20px;">
                                æ–°èç„¦é»å€åŸŸ (çœç•¥ä»¥å°ˆæ³¨æ–¼åˆ—è¡¨æ¸¬è©¦)
                            </div>
                        </section>

                        <!-- ğŸ¯ é‡é»ï¼šç†±é–€è²¨å¹£åˆ—è¡¨ -->
                        <section class="section-trending-coins">
                            <div class="section-header">
                                <h2>ç†±é–€è²¨å¹£</h2>
                                <span class="subtitle">ç²¾é¸ 10 ç¨®ä¸»æµåŠ å¯†è²¨å¹£ï¼Œæ¯ 10 ç§’æ›´æ–°</span>
                            </div>
                            <div class="trending-coins-container">
                                <div class="coins-table">
                                    <div class="table-header">
                                        <div class="col-coin">è²¨å¹£</div>
                                        <div class="col-price">åƒ¹æ ¼</div>
                                        <div class="col-change">24h è®ŠåŒ–</div>
                                        <div class="col-change-amount">æ¼²è·Œé»æ•¸</div>
                                        <div class="col-volume">24h äº¤æ˜“é‡</div>
                                        <div class="col-market-cap">å¸‚å€¼</div>
                                    </div>
                                    <div class="table-body" id="trending-coins-list">
                                        <div class="loading-row">
                                            <div class="loading-spinner"></div>
                                            <span>å¼·åˆ¶è¼‰å…¥ç†±é–€è²¨å¹£ä¸­...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- JavaScript æ¨¡çµ„ -->
    <script src="/js/crypto-icons-map.js"></script>
    <script src="/js/lib/api.js"></script>
    <script src="/js/lib/dom.js"></script>
    <script src="/js/lib/router.js"></script>
    <script src="/js/state/store.js"></script>
    <script src="/js/components/Notification.js"></script>
    <script src="/js/components/CryptoCurrencyList.js"></script>
    <script src="/js/components/HomeCryptoList.js"></script>
    <script src="/js/components/NewsTicker.js"></script>

    <script>
        // å¼·åˆ¶åˆå§‹åŒ–ç†±é–€è²¨å¹£åˆ—è¡¨
        async function forceInitCoinsList() {
            console.log('ğŸ¯ å¼·åˆ¶åˆå§‹åŒ–ç†±é–€è²¨å¹£åˆ—è¡¨...');
            
            const container = document.getElementById('trending-coins-list');
            if (!container) {
                console.error('âŒ æ‰¾ä¸åˆ°å®¹å™¨');
                return;
            }

            try {
                // æª¢æŸ¥çµ„ä»¶æ˜¯å¦è¼‰å…¥
                console.log('CryptoCurrencyList:', typeof CryptoCurrencyList);
                console.log('HomeCryptoList:', typeof HomeCryptoList);
                console.log('getCryptoIcon:', typeof window.getCryptoIcon);

                // æ–¹æ³•1: ä½¿ç”¨ HomeCryptoList
                if (typeof HomeCryptoList !== 'undefined') {
                    console.log('ğŸ“¦ ä½¿ç”¨ HomeCryptoList åˆå§‹åŒ–...');
                    const homeCrypto = new HomeCryptoList();
                    
                    setTimeout(() => {
                        console.log('æª¢æŸ¥ HomeCryptoList çµæœ...');
                        console.log('å®¹å™¨å…§å®¹:', container.innerHTML.substring(0, 200));
                    }, 3000);
                }

                // æ–¹æ³•2: ä½¿ç”¨ CryptoCurrencyList (å‚™ç”¨)
                setTimeout(() => {
                    if (container.innerHTML.includes('è¼‰å…¥ä¸­') || container.innerHTML.includes('å¼·åˆ¶è¼‰å…¥')) {
                        console.log('ğŸ”„ HomeCryptoList æœªæˆåŠŸï¼Œå˜—è©¦ CryptoCurrencyList...');
                        
                        if (typeof CryptoCurrencyList !== 'undefined') {
                            const cryptoList = new CryptoCurrencyList({
                                container: container,
                                mode: 'fixed',
                                maxCoins: 10,
                                coinsPerPage: 10,
                                updateInterval: 10000
                            });
                        }
                    }
                }, 5000);

                // æ–¹æ³•3: æ‰‹å‹•è¼‰å…¥æ•¸æ“š (æœ€çµ‚å‚™ç”¨)
                setTimeout(() => {
                    if (container.innerHTML.includes('è¼‰å…¥ä¸­') || container.innerHTML.includes('å¼·åˆ¶è¼‰å…¥')) {
                        console.log('ğŸ”§ è‡ªå‹•è¼‰å…¥å¤±æ•—ï¼Œæ‰‹å‹•è¼‰å…¥æ•¸æ“š...');
                        manualLoadCoins();
                    }
                }, 8000);

            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–éŒ¯èª¤:', error);
                setTimeout(() => manualLoadCoins(), 2000);
            }
        }

        // æ‰‹å‹•è¼‰å…¥è²¨å¹£æ•¸æ“š
        async function manualLoadCoins() {
            console.log('ğŸ”§ æ‰‹å‹•è¼‰å…¥è²¨å¹£æ•¸æ“š...');
            
            const container = document.getElementById('trending-coins-list');
            
            try {
                const response = await fetch('/api/market/trending?limit=10');
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || 'ç²å–æ•¸æ“šå¤±æ•—');
                }

                const coins = result.data;
                let html = '';

                coins.forEach((coin, index) => {
                    const changePercent = parseFloat(coin.priceChangePercent || 0);
                    const changeAmount = parseFloat(coin.priceChange || 0);
                    const isPositive = changePercent >= 0;
                    const baseCoin = coin.symbol.replace('USDT', '');
                    
                    // æ¨¡æ“¬å¸‚å€¼
                    const simulatedSupply = {
                        'BTC': 19700000, 'ETH': 120000000, 'USDC': 35000000000,
                        'SOL': 470000000, 'FDUSD': 10000000000
                    };
                    const supply = simulatedSupply[baseCoin] || 1000000000;
                    const marketCap = coin.price * supply;
                    
                    function formatNumber(value) {
                        if (value >= 1e12) return `$${(value/1e12).toFixed(2)}T`;
                        if (value >= 1e9) return `$${(value/1e9).toFixed(2)}B`;
                        if (value >= 1e6) return `$${(value/1e6).toFixed(2)}M`;
                        return `$${value.toFixed(2)}`;
                    }
                    
                    // ç²å–åœ–æ¨™
                    const iconHtml = window.getCryptoIcon ? window.getCryptoIcon(coin.symbol, 32) : 
                        `<div style="width: 32px; height: 32px; background: #666; color: white; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; font-size: 12px;">${baseCoin.substring(0, 3)}</div>`;
                    
                    html += `
                        <div class="coin-row">
                            <div class="col-coin">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    ${iconHtml}
                                    <div>
                                        <div style="font-weight: bold;">${baseCoin}</div>
                                        <div style="font-size: 0.8em; color: #aaa;">${coin.name}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-price">$${parseFloat(coin.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 6})}</div>
                            <div class="col-change" style="color: ${isPositive ? '#00d4aa' : '#ff4757'};">${changePercent.toFixed(2)}%</div>
                            <div class="col-change-amount" style="color: ${isPositive ? '#00d4aa' : '#ff4757'};">${isPositive ? '+' : ''}$${Math.abs(changeAmount).toFixed(4)}</div>
                            <div class="col-volume">${formatNumber(coin.quoteVolume)}</div>
                            <div class="col-market-cap">${formatNumber(marketCap)}</div>
                        </div>
                    `;
                });

                container.innerHTML = html;
                console.log('âœ… æ‰‹å‹•è¼‰å…¥æˆåŠŸï¼');

            } catch (error) {
                console.error('âŒ æ‰‹å‹•è¼‰å…¥å¤±æ•—:', error);
                container.innerHTML = `<div style="padding: 20px; text-align: center; color: #ff4757;">è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
            }
        }

        // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
        window.addEventListener('load', () => {
            console.log('ğŸ§ª å®Œæ•´é¦–é æ¸¬è©¦é–‹å§‹...');
            
            setTimeout(() => {
                forceInitCoinsList();
            }, 1000);
        });
    </script>
</body>
</html>