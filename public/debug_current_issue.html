<!DOCTYPE html>
<html>
<head>
    <title>ç•¶å‰å•é¡Œé™¤éŒ¯</title>
    <style>
        body { background: #000; color: white; font-family: Arial; padding: 20px; }
        .debug { background: #222; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #042; }
        .error { background: #420; }
        .warning { background: #440; }
    </style>
</head>
<body>
    <h1>ğŸ” ç•¶å‰å•é¡Œé™¤éŒ¯</h1>
    
    <div id="results"></div>
    
    <h2>TradingView æ¸¬è©¦</h2>
    <div style="border: 1px solid #333; height: 220px; margin: 20px 0;">
        <!-- TradingView Widget BEGIN -->
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright">
                <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
                    <span class="blue-text">Track all markets on TradingView</span>
                </a>
            </div>
        </div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
        {
          "symbol": "BINANCE:BTCUSDT",
          "width": "100%",
          "height": "200",
          "locale": "en",
          "dateRange": "12M",
          "colorTheme": "dark",
          "isTransparent": false,
          "autosize": false,
          "largeChartUrl": ""
        }
        </script>
        <!-- TradingView Widget END -->
    </div>
    
    <script>
        function addResult(type, message) {
            const div = document.createElement('div');
            div.className = `debug ${type}`;
            div.innerHTML = `<strong>${type.toUpperCase()}:</strong> ${message}`;
            document.getElementById('results').appendChild(div);
        }
        
        // æª¢æŸ¥å„ç¨®å¯èƒ½çš„å•é¡Œ
        console.log('=== é™¤éŒ¯é–‹å§‹ ===');
        
        // 1. æª¢æŸ¥ç¶²è·¯é€£æ¥
        fetch('https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js')
            .then(response => {
                if (response.ok) {
                    addResult('success', 'TradingView è…³æœ¬å¯ä»¥æ­£å¸¸è¨ªå•');
                } else {
                    addResult('error', `TradingView è…³æœ¬å›æ‡‰éŒ¯èª¤: ${response.status}`);
                }
            })
            .catch(error => {
                addResult('error', `TradingView è…³æœ¬è¼‰å…¥å¤±æ•—: ${error.message}`);
            });
        
        // 2. æª¢æŸ¥ CSP
        document.addEventListener('securitypolicyviolation', function(e) {
            addResult('error', `CSP é•è¦: ${e.violatedDirective} - ${e.blockedURI}`);
        });
        
        // 3. æª¢æŸ¥è…³æœ¬éŒ¯èª¤
        window.addEventListener('error', function(e) {
            addResult('error', `è…³æœ¬éŒ¯èª¤: ${e.message} (${e.filename}:${e.lineno})`);
        });
        
        // 4. æª¢æŸ¥é¦–é çš„åœ–è¡¨å¡ç‰‡çµæ§‹
        setTimeout(() => {
            const mainPageCards = window.parent.document ? 
                window.parent.document.querySelectorAll('.chart-card') : 
                [];
            
            if (mainPageCards.length > 0) {
                addResult('success', `é¦–é æ‰¾åˆ° ${mainPageCards.length} å€‹åœ–è¡¨å¡ç‰‡`);
                
                mainPageCards.forEach((card, index) => {
                    const symbol = card.querySelector('.coin-symbol');
                    const symbolText = symbol ? symbol.textContent : 'æœªçŸ¥';
                    addResult('success', `åœ–è¡¨å¡ç‰‡ ${index + 1}: ${symbolText}`);
                });
            } else {
                addResult('warning', 'ç„¡æ³•è¨ªå•é¦–é çš„åœ–è¡¨å¡ç‰‡ (å¯èƒ½æ˜¯è·¨æ¡†æ¶é™åˆ¶)');
            }
        }, 1000);
        
        // 5. æª¢æŸ¥ TradingView å°å·¥å…·è¼‰å…¥
        setTimeout(() => {
            const widget = document.querySelector('.tradingview-widget-container__widget');
            if (widget && widget.hasChildNodes()) {
                addResult('success', 'TradingView å°å·¥å…·è¼‰å…¥æˆåŠŸ');
            } else {
                addResult('error', 'TradingView å°å·¥å…·æœªè¼‰å…¥');
            }
        }, 5000);
        
        addResult('success', 'é™¤éŒ¯è…³æœ¬åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>