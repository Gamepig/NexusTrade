<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦–é ç†±é–€è²¨å¹£è¨ºæ–·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f0f0f;
            color: white;
            padding: 20px;
        }
        .debug-section {
            background: #1a1a1a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .error { color: #ff4757; }
        .success { color: #00d4aa; }
        .warning { color: #ffa502; }
        button {
            background: #f7931a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ  é¦–é ç†±é–€è²¨å¹£è¨ºæ–·</h1>
    
    <div class="debug-section">
        <h2>1. DOM å…ƒç´ æª¢æŸ¥</h2>
        <button onclick="checkDOMElements()">æª¢æŸ¥ DOM å…ƒç´ </button>
        <pre id="dom-check"></pre>
    </div>
    
    <div class="debug-section">
        <h2>2. çµ„ä»¶è¼‰å…¥æª¢æŸ¥</h2>
        <button onclick="checkComponents()">æª¢æŸ¥çµ„ä»¶</button>
        <pre id="component-check"></pre>
    </div>
    
    <div class="debug-section">
        <h2>3. API æ¸¬è©¦</h2>
        <button onclick="testAPI()">æ¸¬è©¦ API</button>
        <pre id="api-test"></pre>
    </div>
    
    <div class="debug-section">
        <h2>4. æ‰‹å‹•åˆå§‹åŒ–ç†±é–€è²¨å¹£</h2>
        <button onclick="manualInit()">æ‰‹å‹•åˆå§‹åŒ–</button>
        <pre id="manual-init"></pre>
    </div>
    
    <div class="debug-section">
        <h2>5. æ§åˆ¶å°æ—¥èªŒ</h2>
        <button onclick="showConsoleLogs()">é¡¯ç¤ºæ—¥èªŒ</button>
        <pre id="console-logs"></pre>
    </div>

    <script>
        let logs = [];
        
        // æ•ç²console.log
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            logs.push({type: 'log', time: new Date().toLocaleTimeString(), args});
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logs.push({type: 'error', time: new Date().toLocaleTimeString(), args});
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            logs.push({type: 'warn', time: new Date().toLocaleTimeString(), args});
            originalWarn.apply(console, args);
        };

        function checkDOMElements() {
            const result = document.getElementById('dom-check');
            const checks = {
                'trending-coins-list': document.getElementById('trending-coins-list'),
                'CryptoCurrencyList class': typeof CryptoCurrencyList !== 'undefined',
                'HomeCryptoList class': typeof HomeCryptoList !== 'undefined',
                'getCryptoIcon function': typeof window.getCryptoIcon === 'function',
                'NexusTradeApp instance': typeof window.app !== 'undefined'
            };
            
            let output = '';
            for (const [name, check] of Object.entries(checks)) {
                const status = check ? 'âœ…' : 'âŒ';
                const color = check ? 'success' : 'error';
                output += `<span class="${color}">${status} ${name}: ${check ? 'OK' : 'MISSING'}</span>\n`;
            }
            
            result.innerHTML = output;
        }

        function checkComponents() {
            const result = document.getElementById('component-check');
            let output = '';
            
            try {
                // æª¢æŸ¥å…¨å±€è®Šæ•¸
                output += `NexusTradeApp: ${typeof NexusTradeApp}\n`;
                output += `CryptoCurrencyList: ${typeof CryptoCurrencyList}\n`;
                output += `HomeCryptoList: ${typeof HomeCryptoList}\n`;
                output += `window.app: ${typeof window.app}\n`;
                
                // æª¢æŸ¥ app å¯¦ä¾‹
                if (window.app) {
                    output += `app.homeCryptoListComponent: ${typeof window.app.homeCryptoListComponent}\n`;
                }
                
                // æª¢æŸ¥å®¹å™¨
                const container = document.getElementById('trending-coins-list');
                if (container) {
                    output += `Container innerHTML length: ${container.innerHTML.length}\n`;
                    output += `Container component: ${typeof container.component}\n`;
                }
                
            } catch (error) {
                output += `<span class="error">éŒ¯èª¤: ${error.message}</span>\n`;
            }
            
            result.innerHTML = output;
        }

        async function testAPI() {
            const result = document.getElementById('api-test');
            result.innerHTML = 'æ¸¬è©¦ä¸­...\n';
            
            try {
                // æ¸¬è©¦å¥åº·æª¢æŸ¥
                const healthResponse = await fetch('/health');
                const healthData = await healthResponse.json();
                result.innerHTML += `<span class="success">âœ… å¥åº·æª¢æŸ¥: ${healthData.status}</span>\n`;
                
                // æ¸¬è©¦ç†±é–€è²¨å¹£ API
                const trendingResponse = await fetch('/api/market/trending?limit=5');
                const trendingData = await trendingResponse.json();
                result.innerHTML += `<span class="success">âœ… ç†±é–€è²¨å¹£ API: ${trendingData.success ? 'OK' : 'FAILED'}</span>\n`;
                result.innerHTML += `è²¨å¹£æ•¸é‡: ${trendingData.data?.length || 0}\n`;
                
                if (trendingData.data?.length > 0) {
                    result.innerHTML += `ç¬¬ä¸€å€‹è²¨å¹£: ${JSON.stringify(trendingData.data[0], null, 2)}\n`;
                }
                
            } catch (error) {
                result.innerHTML += `<span class="error">âŒ API éŒ¯èª¤: ${error.message}</span>\n`;
            }
        }

        async function manualInit() {
            const result = document.getElementById('manual-init');
            result.innerHTML = 'æ‰‹å‹•åˆå§‹åŒ–ä¸­...\n';
            
            try {
                const container = document.getElementById('trending-coins-list');
                if (!container) {
                    result.innerHTML += '<span class="error">âŒ æ‰¾ä¸åˆ°å®¹å™¨å…ƒç´ </span>\n';
                    return;
                }
                
                // æª¢æŸ¥ CryptoCurrencyList æ˜¯å¦å­˜åœ¨
                if (typeof CryptoCurrencyList === 'undefined') {
                    result.innerHTML += '<span class="error">âŒ CryptoCurrencyList æœªå®šç¾©</span>\n';
                    return;
                }
                
                // æ‰‹å‹•å‰µå»ºå¯¦ä¾‹
                result.innerHTML += 'æ­£åœ¨å‰µå»º CryptoCurrencyList å¯¦ä¾‹...\n';
                
                const cryptoList = new CryptoCurrencyList({
                    container: container,
                    mode: 'fixed',
                    maxCoins: 10,
                    coinsPerPage: 10,
                    updateInterval: 15000,
                    onCoinClick: (symbol) => {
                        console.log(`é»æ“Šè²¨å¹£: ${symbol}`);
                    }
                });
                
                result.innerHTML += '<span class="success">âœ… CryptoCurrencyList å¯¦ä¾‹å‰µå»ºæˆåŠŸ</span>\n';
                result.innerHTML += `å¯¦ä¾‹é¡å‹: ${typeof cryptoList}\n`;
                
                // ç­‰å¾…ä¸€ä¸‹çœ‹çµæœ
                setTimeout(() => {
                    const containerContent = container.innerHTML;
                    result.innerHTML += `å®¹å™¨å…§å®¹é•·åº¦: ${containerContent.length}\n`;
                    if (containerContent.includes('coin-row') || containerContent.includes('crypto-')) {
                        result.innerHTML += '<span class="success">âœ… è²¨å¹£æ•¸æ“šå·²è¼‰å…¥</span>\n';
                    } else {
                        result.innerHTML += '<span class="warning">âš ï¸ å¯èƒ½é‚„åœ¨è¼‰å…¥ä¸­</span>\n';
                    }
                }, 3000);
                
            } catch (error) {
                result.innerHTML += `<span class="error">âŒ åˆå§‹åŒ–éŒ¯èª¤: ${error.message}</span>\n`;
                result.innerHTML += `Stack: ${error.stack}\n`;
            }
        }

        function showConsoleLogs() {
            const result = document.getElementById('console-logs');
            let output = `ç¸½å…± ${logs.length} æ¢æ—¥èªŒ:\n\n`;
            
            logs.slice(-20).forEach(log => {
                const typeClass = log.type === 'error' ? 'error' : log.type === 'warn' ? 'warning' : 'success';
                output += `<span class="${typeClass}">[${log.time}] ${log.type.toUpperCase()}: ${log.args.join(' ')}</span>\n`;
            });
            
            result.innerHTML = output;
        }

        // è‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkDOMElements();
                checkComponents();
            }, 1000);
        });
    </script>
</body>
</html>