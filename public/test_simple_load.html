<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–®è¼‰å…¥æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; background: #0f0f0f; color: white; padding: 20px; }
        .section { background: #1a1a1a; padding: 20px; margin: 20px 0; border-radius: 8px; }
        button { background: #f7931a; color: white; border: none; padding: 10px 20px; border-radius: 4px; margin: 5px; }
        pre { background: #000; padding: 10px; border-radius: 4px; white-space: pre-wrap; }
        .crypto-icon-text { display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ç°¡å–®è¼‰å…¥æ¸¬è©¦</h1>
    
    <div class="section">
        <h2>1. ç›´æ¥æ¸¬è©¦ API</h2>
        <button onclick="testAPI()">æ¸¬è©¦API</button>
        <pre id="api-result"></pre>
    </div>
    
    <div class="section">
        <h2>2. æ¸¬è©¦çµ„ä»¶è¼‰å…¥</h2>
        <button onclick="testComponents()">æª¢æŸ¥çµ„ä»¶</button>
        <pre id="component-result"></pre>
    </div>
    
    <div class="section">
        <h2>3. æ‰‹å‹•è¼‰å…¥ç†±é–€è²¨å¹£</h2>
        <button onclick="manualLoadCoins()">æ‰‹å‹•è¼‰å…¥</button>
        <div id="manual-coins" style="background: #2a2a2a; padding: 10px; margin-top: 10px; border-radius: 4px;"></div>
    </div>

    <!-- è¼‰å…¥æ‰€æœ‰å¿…è¦çš„è…³æœ¬ -->
    <script src="/js/crypto-icons.js"></script>
    <script src="/js/lib/api.js"></script>
    <script src="/js/lib/dom.js"></script>
    <script src="/js/lib/router.js"></script>
    <script src="/js/state/store.js"></script>
    <script src="/js/components/Notification.js"></script>
    <script src="/js/components/CryptoCurrencyList.js"></script>
    <script src="/js/components/HomeCryptoList.js"></script>

    <script>
        async function testAPI() {
            const result = document.getElementById('api-result');
            result.textContent = 'æ¸¬è©¦ä¸­...\n';
            
            try {
                const response = await fetch('/api/market/trending?limit=5');
                const data = await response.json();
                
                result.textContent = `ç‹€æ…‹: ${data.success ? 'æˆåŠŸ' : 'å¤±æ•—'}\n`;
                result.textContent += `è³‡æ–™æ•¸é‡: ${data.data?.length || 0}\n`;
                
                if (data.data && data.data.length > 0) {
                    result.textContent += `ç¬¬ä¸€ç­†è³‡æ–™: ${JSON.stringify(data.data[0], null, 2)}\n`;
                }
            } catch (error) {
                result.textContent = `éŒ¯èª¤: ${error.message}\n`;
            }
        }

        function testComponents() {
            const result = document.getElementById('component-result');
            
            result.textContent = `CryptoCurrencyList: ${typeof CryptoCurrencyList}\n`;
            result.textContent += `HomeCryptoList: ${typeof HomeCryptoList}\n`;
            result.textContent += `getCryptoIcon: ${typeof window.getCryptoIcon}\n`;
            result.textContent += `CryptoIcons: ${typeof window.CryptoIcons}\n`;
            result.textContent += `CryptoColors: ${typeof window.CryptoColors}\n`;
        }

        async function manualLoadCoins() {
            const container = document.getElementById('manual-coins');
            container.innerHTML = 'è¼‰å…¥ä¸­...';
            
            try {
                // ç²å–APIæ•¸æ“š
                const response = await fetch('/api/market/trending?limit=10');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message);
                }
                
                // æ‰‹å‹•æ¸²æŸ“
                const coins = data.data;
                let html = `
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr; gap: 12px; background: #333; padding: 10px; font-weight: bold;">
                        <div>è²¨å¹£</div>
                        <div style="text-align: center;">åƒ¹æ ¼</div>
                        <div style="text-align: center;">24h è®ŠåŒ–</div>
                        <div style="text-align: center;">æ¼²è·Œé»æ•¸</div>
                        <div style="text-align: center;">24h äº¤æ˜“é‡</div>
                        <div style="text-align: center;">å¸‚å€¼</div>
                    </div>
                `;
                
                coins.forEach((coin, index) => {
                    const changePercent = parseFloat(coin.priceChangePercent || 0);
                    const changeAmount = parseFloat(coin.priceChange || 0);
                    const isPositive = changePercent >= 0;
                    const baseCoin = coin.symbol.replace('USDT', '');
                    
                    // è¨ˆç®—æ¨¡æ“¬å¸‚å€¼
                    const simulatedSupply = {
                        'BTC': 19700000,
                        'ETH': 120000000,
                        'USDC': 35000000000,
                        'SOL': 470000000,
                        'FDUSD': 10000000000,
                        'XRP': 55000000000,
                        'PEPE': 420690000000000,
                        'SUI': 10000000000,
                        'DOGE': 146000000000,
                        'UNI': 1000000000
                    };
                    
                    const supply = simulatedSupply[baseCoin] || 1000000000;
                    const marketCap = coin.price * supply;
                    
                    function formatMarketCap(value) {
                        if (value >= 1e12) return `$${(value/1e12).toFixed(2)}T`;
                        if (value >= 1e9) return `$${(value/1e9).toFixed(2)}B`;
                        if (value >= 1e6) return `$${(value/1e6).toFixed(2)}M`;
                        return `$${value.toFixed(2)}`;
                    }
                    
                    function formatVolume(value) {
                        if (value >= 1e9) return `$${(value/1e9).toFixed(2)}B`;
                        if (value >= 1e6) return `$${(value/1e6).toFixed(2)}M`;
                        if (value >= 1e3) return `$${(value/1e3).toFixed(2)}K`;
                        return `$${value.toFixed(2)}`;
                    }
                    
                    // ä½¿ç”¨ getCryptoIcon å‡½æ•¸
                    let iconHtml = '';
                    if (typeof window.getCryptoIcon === 'function') {
                        iconHtml = window.getCryptoIcon(coin.symbol, 32);
                    } else {
                        // å¾Œå‚™æ–¹æ¡ˆ
                        const colors = {
                            'btc': '#f7931a', 'eth': '#627eea', 'usdc': '#2775ca', 'sol': '#9945ff',
                            'fdusd': '#f0b90b', 'xrp': '#00aae4', 'pepe': '#4caf50', 'sui': '#6d6d6d',
                            'doge': '#c2a633', 'uni': '#ff007a'
                        };
                        const color = colors[baseCoin.toLowerCase()] || '#666666';
                        iconHtml = `<div class="crypto-icon-text" style="width: 32px; height: 32px; background: ${color}; color: white; font-size: 12px;">${baseCoin.substring(0, 3)}</div>`;
                    }
                    
                    html += `
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 10px; border-bottom: 1px solid #444; align-items: center; text-align: center;">
                            <div style="display: flex; align-items: center; gap: 10px; text-align: left;">
                                ${iconHtml}
                                <div>
                                    <div style="font-weight: bold;">${baseCoin}</div>
                                    <div style="font-size: 0.8em; color: #aaa;">${coin.name}</div>
                                </div>
                            </div>
                            <div>$${parseFloat(coin.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 6})}</div>
                            <div style="color: ${isPositive ? '#00d4aa' : '#ff4757'};">${changePercent.toFixed(2)}%</div>
                            <div style="color: ${isPositive ? '#00d4aa' : '#ff4757'};">${isPositive ? '+' : ''}$${Math.abs(changeAmount).toFixed(4)}</div>
                            <div>${formatVolume(coin.quoteVolume)}</div>
                            <div>${formatMarketCap(marketCap)}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `éŒ¯èª¤: ${error.message}`;
            }
        }

        // è‡ªå‹•åŸ·è¡Œæ¸¬è©¦
        window.addEventListener('load', () => {
            console.log('é é¢è¼‰å…¥å®Œæˆ');
            setTimeout(() => {
                testComponents();
                testAPI();
            }, 1000);
        });
    </script>
</body>
</html>