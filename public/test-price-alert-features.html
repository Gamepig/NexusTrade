<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒ¹æ ¼è­¦å ±åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        .test-section h2 {
            color: #4CAF50;
            margin-top: 0;
        }
        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .btn:hover {
            background: #1976D2;
        }
        .btn-success {
            background: #4CAF50;
        }
        .btn-warning {
            background: #FF9800;
        }
        .btn-danger {
            background: #F44336;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .result-success {
            background: rgba(76, 175, 80, 0.1);
            border-left-color: #4CAF50;
        }
        .result-error {
            background: rgba(244, 67, 54, 0.1);
            border-left-color: #F44336;
        }
        .result-warning {
            background: rgba(255, 152, 0, 0.1);
            border-left-color: #FF9800;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-pass { background: #4CAF50; }
        .status-fail { background: #F44336; }
        .status-pending { background: #FF9800; }
        .json-display {
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”” åƒ¹æ ¼è­¦å ±åŠŸèƒ½æ¸¬è©¦é©—è­‰</h1>
    <p><strong>ç›®çš„</strong>ï¼šå…¨é¢æ¸¬è©¦æ–°å¯¦ç¾çš„åƒ¹æ ¼è­¦å ±ç®¡ç†åŠŸèƒ½</p>

    <div class="test-grid">
        <!-- æ¸¬è©¦ 1: èªè­‰ç‹€æ…‹æª¢æŸ¥ -->
        <div class="test-section">
            <h2>ğŸ” æ¸¬è©¦ 1: èªè­‰ç‹€æ…‹æª¢æŸ¥</h2>
            <div id="auth-test-results">è¼‰å…¥ä¸­...</div>
            <button class="btn" onclick="testAuthenticationStatus()">ğŸ”„ é‡æ–°æª¢æŸ¥èªè­‰</button>
            <button class="btn btn-warning" onclick="simulateUser('free')">ğŸ†“ æ¨¡æ“¬å…è²»æœƒå“¡</button>
            <button class="btn btn-success" onclick="simulateUser('premium')">ğŸš€ æ¨¡æ“¬ä»˜è²»æœƒå“¡</button>
            <button class="btn btn-warning" onclick="simulateUser('enterprise')">ğŸ‘‘ æ¨¡æ“¬ä¼æ¥­æœƒå“¡</button>
        </div>

        <!-- æ¸¬è©¦ 2: æŒ‰éˆ•ç‹€æ…‹é¡¯ç¤º -->
        <div class="test-section">
            <h2>ğŸ”˜ æ¸¬è©¦ 2: æŒ‰éˆ•ç‹€æ…‹é¡¯ç¤º</h2>
            <div id="button-status-results">è¼‰å…¥ä¸­...</div>
            <button class="btn" onclick="testButtonStates()">ğŸ§ª æ¸¬è©¦æŒ‰éˆ•ç‹€æ…‹</button>
            <button class="btn btn-success" onclick="openPriceAlertModal('BTCUSDT')">ğŸ”” é–‹å•Ÿè­¦å ±è¨­å®š</button>
        </div>

        <!-- æ¸¬è©¦ 3: æœƒå“¡é…é¡æª¢æŸ¥ -->
        <div class="test-section">
            <h2>ğŸ’ æ¸¬è©¦ 3: æœƒå“¡é…é¡æª¢æŸ¥</h2>
            <div id="quota-test-results">è¼‰å…¥ä¸­...</div>
            <button class="btn" onclick="testQuotaLimits()">ğŸ“Š æ¸¬è©¦é…é¡é™åˆ¶</button>
            <button class="btn btn-warning" onclick="simulateAlertsCount(0)">è¨­å®š 0 å€‹è­¦å ±</button>
            <button class="btn btn-warning" onclick="simulateAlertsCount(1)">è¨­å®š 1 å€‹è­¦å ±</button>
            <button class="btn btn-danger" onclick="simulateAlertsCount(2)">è¨­å®š 2 å€‹è­¦å ±</button>
        </div>

        <!-- æ¸¬è©¦ 4: è­¦å ±ç®¡ç†é é¢ -->
        <div class="test-section">
            <h2>ğŸ“‹ æ¸¬è©¦ 4: è­¦å ±ç®¡ç†é é¢</h2>
            <div id="page-test-results">è¼‰å…¥ä¸­...</div>
            <button class="btn" onclick="testPriceAlertsPage()">ğŸ”— æ¸¬è©¦åƒ¹æ ¼è­¦å ±é é¢</button>
            <button class="btn btn-success" onclick="navigateToPriceAlerts()">ğŸ“„ è¨ªå•è­¦å ±é é¢</button>
        </div>

        <!-- æ¸¬è©¦ 5: äº‹ä»¶åŒæ­¥ -->
        <div class="test-section">
            <h2>ğŸ”„ æ¸¬è©¦ 5: ç‹€æ…‹åŒæ­¥</h2>
            <div id="sync-test-results">è¼‰å…¥ä¸­...</div>
            <button class="btn" onclick="testEventSynchronization()">âš¡ æ¸¬è©¦äº‹ä»¶åŒæ­¥</button>
            <button class="btn btn-success" onclick="simulateAlertStatusChange()">ğŸ“¢ æ¨¡æ“¬ç‹€æ…‹è®Šæ›´</button>
        </div>

        <!-- æ¸¬è©¦ 6: å‡ç´šæ¨¡æ…‹æ¡† -->
        <div class="test-section">
            <h2>ğŸš€ æ¸¬è©¦ 6: å‡ç´šåŠŸèƒ½</h2>
            <div id="upgrade-test-results">è¼‰å…¥ä¸­...</div>
            <button class="btn" onclick="testUpgradeModal()">ğŸ’° æ¸¬è©¦å‡ç´šæ¨¡æ…‹æ¡†</button>
            <button class="btn btn-success" onclick="showUpgradeDemo('free')">ğŸ†“ å…è²»æœƒå“¡å‡ç´š</button>
            <button class="btn btn-success" onclick="showUpgradeDemo('premium')">ğŸš€ ä»˜è²»æœƒå“¡å‡ç´š</button>
        </div>
    </div>

    <!-- å…¨å±€æ¸¬è©¦çµæœ -->
    <div class="test-section">
        <h2>ğŸ“Š å…¨å±€æ¸¬è©¦çµæœ</h2>
        <div id="overall-results">
            <div class="result result-warning">â³ ç­‰å¾…æ¸¬è©¦åŸ·è¡Œ...</div>
        </div>
        <button class="btn btn-success" onclick="runAllTests()">ğŸ§ª åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦</button>
        <button class="btn btn-warning" onclick="generateTestReport()">ğŸ“„ ç”Ÿæˆæ¸¬è©¦å ±å‘Š</button>
    </div>

    <script>
        let testResults = {
            auth: null,
            buttonStates: null,
            quotaLimits: null,
            pageAccess: null,
            eventSync: null,
            upgradeModal: null
        };

        /**
         * æ¸¬è©¦èªè­‰ç‹€æ…‹
         */
        function testAuthenticationStatus() {
            const resultsDiv = document.getElementById('auth-test-results');
            resultsDiv.innerHTML = '<div class="result result-warning">ğŸ”„ æª¢æŸ¥èªè­‰ç‹€æ…‹...</div>';
            
            try {
                const token = localStorage.getItem('nexustrade_token');
                const userStr = localStorage.getItem('nexustrade_user');
                const user = userStr ? JSON.parse(userStr) : null;
                
                let html = '<h3>ğŸ” èªè­‰ç‹€æ…‹æª¢æŸ¥</h3>';
                
                // æª¢æŸ¥ Token
                if (!token) {
                    html += '<div class="result result-error">âŒ æ²’æœ‰èªè­‰ Token</div>';
                    testResults.auth = 'fail';
                } else {
                    html += '<div class="result result-success">âœ… èªè­‰ Token å­˜åœ¨</div>';
                }
                
                // æª¢æŸ¥ç”¨æˆ¶è³‡æ–™
                if (!user) {
                    html += '<div class="result result-error">âŒ æ²’æœ‰ç”¨æˆ¶è³‡æ–™</div>';
                    testResults.auth = 'fail';
                } else {
                    html += `<div class="result result-success">âœ… ç”¨æˆ¶: ${user.name}</div>`;
                    html += `<div class="result result-success">âœ… æœƒå“¡é¡å‹: ${user.membershipType || 'free'}</div>`;
                    html += `<div class="result result-success">âœ… LINE é€£æ¥: ${user.lineUserId ? 'å·²é€£æ¥' : 'æœªé€£æ¥'}</div>`;
                    testResults.auth = 'pass';
                }
                
                // æª¢æŸ¥çµ„ä»¶æ˜¯å¦è¼‰å…¥
                const components = ['PriceAlertModal', 'CurrencyDetailPage', 'priceAlertModal'];
                components.forEach(comp => {
                    if (window[comp]) {
                        html += `<div class="result result-success">âœ… ${comp} å·²è¼‰å…¥</div>`;
                    } else {
                        html += `<div class="result result-warning">âš ï¸ ${comp} æœªè¼‰å…¥</div>`;
                    }
                });
                
                resultsDiv.innerHTML = html;
                updateOverallResults();
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result result-error">âŒ æª¢æŸ¥å¤±æ•—: ${error.message}</div>`;
                testResults.auth = 'fail';
            }
        }

        /**
         * æ¨¡æ“¬ä¸åŒæœƒå“¡é¡å‹
         */
        function simulateUser(membershipType) {
            const user = {
                id: 'test-user-123',
                name: 'Test User',
                email: 'test@example.com',
                membershipType: membershipType,
                lineUserId: 'test-line-id',
                provider: 'line'
            };
            
            localStorage.setItem('nexustrade_user', JSON.stringify(user));
            localStorage.setItem('nexustrade_token', 'test-token-123');
            
            testAuthenticationStatus();
            
            const membershipNames = {
                free: 'å…è²»æœƒå“¡',
                premium: 'ä»˜è²»æœƒå“¡',
                enterprise: 'ä¼æ¥­æœƒå“¡'
            };
            
            alert(`âœ… å·²æ¨¡æ“¬ ${membershipNames[membershipType]} ç‹€æ…‹`);
        }

        /**
         * æ¸¬è©¦æŒ‰éˆ•ç‹€æ…‹
         */
        function testButtonStates() {
            const resultsDiv = document.getElementById('button-status-results');
            resultsDiv.innerHTML = '<div class="result result-warning">ğŸ”„ æ¸¬è©¦æŒ‰éˆ•ç‹€æ…‹...</div>';
            
            let html = '<h3>ğŸ”˜ æŒ‰éˆ•ç‹€æ…‹æ¸¬è©¦</h3>';
            
            // æª¢æŸ¥ CurrencyDetailPage æ–¹æ³•
            if (typeof window.CurrencyDetailPage !== 'undefined') {
                html += '<div class="result result-success">âœ… CurrencyDetailPage é¡åˆ¥å­˜åœ¨</div>';
                
                // æª¢æŸ¥é—œéµæ–¹æ³•
                const methods = ['checkAlertStatus', 'updateAlertButton', 'setupAlertStatusListener'];
                const prototype = window.CurrencyDetailPage.prototype;
                
                methods.forEach(method => {
                    if (typeof prototype[method] === 'function') {
                        html += `<div class="result result-success">âœ… ${method} æ–¹æ³•å­˜åœ¨</div>`;
                    } else {
                        html += `<div class="result result-error">âŒ ${method} æ–¹æ³•ç¼ºå¤±</div>`;
                    }
                });
                
                testResults.buttonStates = 'pass';
            } else {
                html += '<div class="result result-error">âŒ CurrencyDetailPage é¡åˆ¥ä¸å­˜åœ¨</div>';
                testResults.buttonStates = 'fail';
            }
            
            // æª¢æŸ¥ CSS æ¨£å¼
            const requiredClasses = ['.action-btn.alert-active', '.quota-status', '.upgrade-modal'];
            requiredClasses.forEach(className => {
                const styleSheets = Array.from(document.styleSheets);
                let found = false;
                
                try {
                    styleSheets.forEach(sheet => {
                        try {
                            const rules = Array.from(sheet.cssRules || sheet.rules || []);
                            if (rules.some(rule => rule.selectorText && rule.selectorText.includes(className.substring(1)))) {
                                found = true;
                            }
                        } catch (e) {
                            // è·¨åŸŸæ¨£å¼è¡¨ï¼Œç„¡æ³•æª¢æŸ¥
                        }
                    });
                } catch (e) {
                    console.warn('ç„¡æ³•æª¢æŸ¥æ¨£å¼è¡¨:', e);
                }
                
                if (found) {
                    html += `<div class="result result-success">âœ… CSS æ¨£å¼ ${className} å­˜åœ¨</div>`;
                } else {
                    html += `<div class="result result-warning">âš ï¸ CSS æ¨£å¼ ${className} æœªæ‰¾åˆ°æˆ–ç„¡æ³•æª¢æŸ¥</div>`;
                }
            });
            
            resultsDiv.innerHTML = html;
            updateOverallResults();
        }

        /**
         * æ¸¬è©¦é…é¡é™åˆ¶
         */
        function testQuotaLimits() {
            const resultsDiv = document.getElementById('quota-test-results');
            resultsDiv.innerHTML = '<div class="result result-warning">ğŸ”„ æ¸¬è©¦é…é¡é™åˆ¶...</div>';
            
            let html = '<h3>ğŸ’ é…é¡é™åˆ¶æ¸¬è©¦</h3>';
            
            if (window.priceAlertModal && typeof window.priceAlertModal.checkQuotaLimit === 'function') {
                html += '<div class="result result-success">âœ… checkQuotaLimit æ–¹æ³•å­˜åœ¨</div>';
                
                // æ¸¬è©¦ä¸åŒæœƒå“¡é¡å‹çš„é…é¡
                const membershipTypes = ['free', 'premium', 'enterprise'];
                membershipTypes.forEach(type => {
                    // æ¨¡æ“¬ç”¨æˆ¶é¡å‹
                    const user = JSON.parse(localStorage.getItem('nexustrade_user') || '{}');
                    user.membershipType = type;
                    localStorage.setItem('nexustrade_user', JSON.stringify(user));
                    
                    // æ¸¬è©¦é…é¡æª¢æŸ¥
                    try {
                        window.priceAlertModal.existingAlerts = [];
                        const quota1 = window.priceAlertModal.checkQuotaLimit();
                        
                        window.priceAlertModal.existingAlerts = [{ id: 1 }];
                        const quota2 = window.priceAlertModal.checkQuotaLimit();
                        
                        html += `<div class="result result-success">âœ… ${type}: 0å€‹è­¦å ± - å¯æ–°å¢: ${quota1.canAddMore}</div>`;
                        html += `<div class="result result-success">âœ… ${type}: 1å€‹è­¦å ± - å¯æ–°å¢: ${quota2.canAddMore}</div>`;
                        
                    } catch (error) {
                        html += `<div class="result result-error">âŒ ${type} é…é¡æª¢æŸ¥å¤±æ•—: ${error.message}</div>`;
                    }
                });
                
                testResults.quotaLimits = 'pass';
            } else {
                html += '<div class="result result-error">âŒ checkQuotaLimit æ–¹æ³•ä¸å­˜åœ¨</div>';
                testResults.quotaLimits = 'fail';
            }
            
            resultsDiv.innerHTML = html;
            updateOverallResults();
        }

        /**
         * æ¨¡æ“¬è­¦å ±æ•¸é‡
         */
        function simulateAlertsCount(count) {
            if (window.priceAlertModal) {
                window.priceAlertModal.existingAlerts = Array.from({length: count}, (_, i) => ({
                    id: `alert-${i + 1}`,
                    symbol: 'BTCUSDT',
                    type: 'price_above',
                    targetPrice: 50000 + i * 1000
                }));
                
                alert(`âœ… å·²æ¨¡æ“¬ ${count} å€‹è­¦å ±`);
                testQuotaLimits();
            }
        }

        /**
         * æ¸¬è©¦åƒ¹æ ¼è­¦å ±é é¢
         */
        function testPriceAlertsPage() {
            const resultsDiv = document.getElementById('page-test-results');
            resultsDiv.innerHTML = '<div class="result result-warning">ğŸ”„ æ¸¬è©¦åƒ¹æ ¼è­¦å ±é é¢...</div>';
            
            let html = '<h3>ğŸ“‹ åƒ¹æ ¼è­¦å ±é é¢æ¸¬è©¦</h3>';
            
            // æª¢æŸ¥é é¢å®¹å™¨
            const pageContainer = document.getElementById('price-alerts-page');
            if (pageContainer) {
                html += '<div class="result result-success">âœ… price-alerts-page å®¹å™¨å­˜åœ¨</div>';
            } else {
                html += '<div class="result result-error">âŒ price-alerts-page å®¹å™¨ä¸å­˜åœ¨</div>';
            }
            
            // æª¢æŸ¥å°èˆªé€£çµ
            const navLink = document.querySelector('a[href="#price-alerts"]');
            if (navLink) {
                html += '<div class="result result-success">âœ… å°èˆªé€£çµå­˜åœ¨</div>';
            } else {
                html += '<div class="result result-error">âŒ å°èˆªé€£çµä¸å­˜åœ¨</div>';
            }
            
            // æª¢æŸ¥ PriceAlertsPage é¡åˆ¥
            if (typeof window.PriceAlertsPage !== 'undefined') {
                html += '<div class="result result-success">âœ… PriceAlertsPage é¡åˆ¥å­˜åœ¨</div>';
                testResults.pageAccess = 'pass';
            } else {
                html += '<div class="result result-error">âŒ PriceAlertsPage é¡åˆ¥ä¸å­˜åœ¨</div>';
                testResults.pageAccess = 'fail';
            }
            
            // æª¢æŸ¥ä¸»æ‡‰ç”¨çš„è·¯ç”±é…ç½®
            if (window.app && typeof window.app.loadPriceAlertsData === 'function') {
                html += '<div class="result result-success">âœ… loadPriceAlertsData æ–¹æ³•å­˜åœ¨</div>';
            } else {
                html += '<div class="result result-warning">âš ï¸ loadPriceAlertsData æ–¹æ³•å¯èƒ½ä¸å­˜åœ¨</div>';
            }
            
            resultsDiv.innerHTML = html;
            updateOverallResults();
        }

        /**
         * å°èˆªåˆ°åƒ¹æ ¼è­¦å ±é é¢
         */
        function navigateToPriceAlerts() {
            if (window.app && typeof window.app.navigateToPage === 'function') {
                window.app.navigateToPage('price-alerts');
                alert('âœ… å·²å°èˆªåˆ°åƒ¹æ ¼è­¦å ±é é¢');
            } else {
                window.location.hash = '#price-alerts';
                alert('âœ… å·²å˜—è©¦å°èˆªåˆ°åƒ¹æ ¼è­¦å ±é é¢ (ä½¿ç”¨ hash)');
            }
        }

        /**
         * æ¸¬è©¦äº‹ä»¶åŒæ­¥
         */
        function testEventSynchronization() {
            const resultsDiv = document.getElementById('sync-test-results');
            resultsDiv.innerHTML = '<div class="result result-warning">ğŸ”„ æ¸¬è©¦äº‹ä»¶åŒæ­¥...</div>';
            
            let html = '<h3>ğŸ”„ äº‹ä»¶åŒæ­¥æ¸¬è©¦</h3>';
            let eventReceived = false;
            
            // è¨­å®šäº‹ä»¶ç›£è½å™¨
            const testListener = (event) => {
                eventReceived = true;
                html += `<div class="result result-success">âœ… æ¥æ”¶åˆ°äº‹ä»¶: ${event.type}</div>`;
                html += `<div class="result result-success">âœ… äº‹ä»¶æ•¸æ“š: ${JSON.stringify(event.detail)}</div>`;
                
                resultsDiv.innerHTML = html;
                testResults.eventSync = 'pass';
                updateOverallResults();
                
                // ç§»é™¤ç›£è½å™¨
                window.removeEventListener('alertStatusChanged', testListener);
            };
            
            window.addEventListener('alertStatusChanged', testListener);
            
            // åˆ†ç™¼æ¸¬è©¦äº‹ä»¶
            const testEvent = new CustomEvent('alertStatusChanged', {
                detail: {
                    symbol: 'BTCUSDT',
                    alertCount: 2,
                    hasAlerts: true,
                    alerts: [
                        { id: 1, type: 'price_above', targetPrice: 50000 },
                        { id: 2, type: 'price_below', targetPrice: 45000 }
                    ]
                }
            });
            
            window.dispatchEvent(testEvent);
            
            // æª¢æŸ¥æ˜¯å¦æ”¶åˆ°äº‹ä»¶
            setTimeout(() => {
                if (!eventReceived) {
                    html += '<div class="result result-error">âŒ æœªæ¥æ”¶åˆ°æ¸¬è©¦äº‹ä»¶</div>';
                    resultsDiv.innerHTML = html;
                    testResults.eventSync = 'fail';
                    updateOverallResults();
                }
            }, 1000);
            
            html += '<div class="result result-warning">â³ ç­‰å¾…äº‹ä»¶éŸ¿æ‡‰...</div>';
            resultsDiv.innerHTML = html;
        }

        /**
         * æ¨¡æ“¬è­¦å ±ç‹€æ…‹è®Šæ›´
         */
        function simulateAlertStatusChange() {
            if (window.priceAlertModal && typeof window.priceAlertModal.dispatchAlertStatusUpdateEvent === 'function') {
                window.priceAlertModal.currentSymbol = 'BTCUSDT';
                window.priceAlertModal.existingAlerts = [
                    { id: 1, type: 'price_above', targetPrice: 52000 }
                ];
                window.priceAlertModal.dispatchAlertStatusUpdateEvent();
                alert('âœ… å·²åˆ†ç™¼è­¦å ±ç‹€æ…‹è®Šæ›´äº‹ä»¶');
            } else {
                alert('âŒ dispatchAlertStatusUpdateEvent æ–¹æ³•ä¸å­˜åœ¨');
            }
        }

        /**
         * æ¸¬è©¦å‡ç´šæ¨¡æ…‹æ¡†
         */
        function testUpgradeModal() {
            const resultsDiv = document.getElementById('upgrade-test-results');
            resultsDiv.innerHTML = '<div class="result result-warning">ğŸ”„ æ¸¬è©¦å‡ç´šæ¨¡æ…‹æ¡†...</div>';
            
            let html = '<h3>ğŸš€ å‡ç´šæ¨¡æ…‹æ¡†æ¸¬è©¦</h3>';
            
            if (window.priceAlertModal && typeof window.priceAlertModal.showUpgradeModal === 'function') {
                html += '<div class="result result-success">âœ… showUpgradeModal æ–¹æ³•å­˜åœ¨</div>';
                
                if (typeof window.priceAlertModal.renderUpgradePlans === 'function') {
                    html += '<div class="result result-success">âœ… renderUpgradePlans æ–¹æ³•å­˜åœ¨</div>';
                } else {
                    html += '<div class="result result-error">âŒ renderUpgradePlans æ–¹æ³•ä¸å­˜åœ¨</div>';
                }
                
                if (typeof window.priceAlertModal.renderMembershipStatus === 'function') {
                    html += '<div class="result result-success">âœ… renderMembershipStatus æ–¹æ³•å­˜åœ¨</div>';
                } else {
                    html += '<div class="result result-error">âŒ renderMembershipStatus æ–¹æ³•ä¸å­˜åœ¨</div>';
                }
                
                testResults.upgradeModal = 'pass';
            } else {
                html += '<div class="result result-error">âŒ showUpgradeModal æ–¹æ³•ä¸å­˜åœ¨</div>';
                testResults.upgradeModal = 'fail';
            }
            
            resultsDiv.innerHTML = html;
            updateOverallResults();
        }

        /**
         * é¡¯ç¤ºå‡ç´šæ¨¡æ…‹æ¡†ç¤ºä¾‹
         */
        function showUpgradeDemo(currentPlan) {
            if (window.priceAlertModal && typeof window.priceAlertModal.showUpgradeModal === 'function') {
                window.priceAlertModal.showUpgradeModal(currentPlan);
            } else {
                alert('âŒ showUpgradeModal æ–¹æ³•ä¸å­˜åœ¨');
            }
        }

        /**
         * é–‹å•Ÿåƒ¹æ ¼è­¦å ±æ¨¡æ…‹æ¡†
         */
        function openPriceAlertModal(symbol) {
            if (window.priceAlertModal && typeof window.priceAlertModal.show === 'function') {
                window.priceAlertModal.show(symbol);
            } else {
                alert('âŒ PriceAlertModal ä¸å¯ç”¨');
            }
        }

        /**
         * åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦
         */
        async function runAllTests() {
            const overallDiv = document.getElementById('overall-results');
            overallDiv.innerHTML = '<div class="result result-warning">ğŸ”„ åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦...</div>';
            
            // é‡ç½®æ¸¬è©¦çµæœ
            Object.keys(testResults).forEach(key => testResults[key] = null);
            
            // æŒ‰é †åºåŸ·è¡Œæ¸¬è©¦
            testAuthenticationStatus();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testButtonStates();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testQuotaLimits();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testPriceAlertsPage();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testEventSynchronization();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testUpgradeModal();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // ç­‰å¾…æ‰€æœ‰æ¸¬è©¦å®Œæˆ
            setTimeout(() => {
                updateOverallResults();
                generateTestReport();
            }, 2000);
        }

        /**
         * æ›´æ–°å…¨å±€æ¸¬è©¦çµæœ
         */
        function updateOverallResults() {
            const overallDiv = document.getElementById('overall-results');
            
            const results = Object.values(testResults);
            const passCount = results.filter(r => r === 'pass').length;
            const failCount = results.filter(r => r === 'fail').length;
            const pendingCount = results.filter(r => r === null).length;
            
            let html = '<h3>ğŸ“Š æ¸¬è©¦çµæœçµ±è¨ˆ</h3>';
            html += `<div class="result result-success">
                <span class="status-indicator status-pass"></span>é€šé: ${passCount}
            </div>`;
            html += `<div class="result result-error">
                <span class="status-indicator status-fail"></span>å¤±æ•—: ${failCount}
            </div>`;
            html += `<div class="result result-warning">
                <span class="status-indicator status-pending"></span>å¾…æ¸¬è©¦: ${pendingCount}
            </div>`;
            
            // è©³ç´°çµæœ
            Object.entries(testResults).forEach(([test, result]) => {
                const status = result === 'pass' ? 'success' : result === 'fail' ? 'error' : 'warning';
                const icon = result === 'pass' ? 'âœ…' : result === 'fail' ? 'âŒ' : 'â³';
                const statusClass = result === 'pass' ? 'status-pass' : result === 'fail' ? 'status-fail' : 'status-pending';
                
                html += `<div class="result result-${status}">
                    <span class="status-indicator ${statusClass}"></span>${icon} ${test}: ${result || 'å¾…æ¸¬è©¦'}
                </div>`;
            });
            
            overallDiv.innerHTML = html;
        }

        /**
         * ç”Ÿæˆæ¸¬è©¦å ±å‘Š
         */
        function generateTestReport() {
            const report = {
                timestamp: new Date().toLocaleString('zh-TW'),
                testResults: testResults,
                summary: {
                    total: Object.keys(testResults).length,
                    passed: Object.values(testResults).filter(r => r === 'pass').length,
                    failed: Object.values(testResults).filter(r => r === 'fail').length,
                    pending: Object.values(testResults).filter(r => r === null).length
                },
                environment: {
                    userAgent: navigator.userAgent,
                    url: window.location.href,
                    hasToken: !!localStorage.getItem('nexustrade_token'),
                    hasUser: !!localStorage.getItem('nexustrade_user')
                }
            };
            
            console.log('ğŸ“„ æ¸¬è©¦å ±å‘Š:', report);
            
            // é¡¯ç¤ºå ±å‘Š
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                <head><title>åƒ¹æ ¼è­¦å ±åŠŸèƒ½æ¸¬è©¦å ±å‘Š</title></head>
                <body style="font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff;">
                    <h1>ğŸ”” åƒ¹æ ¼è­¦å ±åŠŸèƒ½æ¸¬è©¦å ±å‘Š</h1>
                    <pre style="background: #2d2d2d; padding: 20px; border-radius: 8px; overflow: auto;">
${JSON.stringify(report, null, 2)}
                    </pre>
                </body>
                </html>
            `);
            
            alert('âœ… æ¸¬è©¦å ±å‘Šå·²ç”Ÿæˆï¼Œè«‹æª¢æŸ¥æ–°é–‹å•Ÿçš„è¦–çª—');
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œåˆå§‹æª¢æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                testAuthenticationStatus();
            }, 1000);
        });
    </script>
</body>
</html>