<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ åƒ¹æ ¼è­¦å ±ä¿®å¾©æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button.success {
            background: #28a745;
        }
        button.warning {
            background: #ffc107;
            color: #212529;
        }
        .test-container {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            min-height: 400px;
            background: white;
        }
        .console-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ åƒ¹æ ¼è­¦å ±æ–°å¢æŒ‰éˆ•ä¿®å¾©æ¸¬è©¦</h1>
        <p>æ¸¬è©¦ä¿®å¾©å¾Œçš„åƒ¹æ ¼è­¦å ±æ–°å¢åŠŸèƒ½</p>

        <!-- æ¸¬è©¦æ§åˆ¶ -->
        <div class="test-section">
            <h3>æ¸¬è©¦æ§åˆ¶</h3>
            <button onclick="testWithoutLogin()" class="warning">ğŸš« æ¸¬è©¦æœªç™»å…¥ç‹€æ…‹</button>
            <button onclick="setupLoginAndTest()" class="success">âœ… è¨­ç½®ç™»å…¥ä¸¦æ¸¬è©¦</button>
            <button onclick="refreshUserQuota()" style="background: #28a745;">ğŸ”„ é‡æ–°æ•´ç†é…é¡</button>
            <button onclick="clearAuth()">ğŸ—‘ï¸ æ¸…é™¤èªè­‰</button>
            <button onclick="clearConsole()">ğŸ§¹ æ¸…ç©ºæ§åˆ¶å°</button>
        </div>

        <!-- æ¸¬è©¦å®¹å™¨ -->
        <div class="test-section">
            <h3>åƒ¹æ ¼è­¦å ±é é¢æ¸¬è©¦å®¹å™¨</h3>
            <div id="test-container" class="test-container">
                <div id="price-alerts-page">
                    <div class="page-header">
                        <h1>ğŸ’° åƒ¹æ ¼è­¦å ±</h1>
                        <p>ç®¡ç†ä½ çš„åƒ¹æ ¼æé†’èˆ‡é€šçŸ¥è¨­å®š</p>
                    </div>
                    <div id="price-alerts-content" class="page-content">
                        <div class="loading-spinner">æº–å‚™è¼‰å…¥æ¸¬è©¦...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶å°è¼¸å‡º -->
        <div class="test-section">
            <h3>æ§åˆ¶å°è¼¸å‡º</h3>
            <div id="console-output" class="console-output"></div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„çµ„ä»¶ -->
    <script src="/js/components/PriceAlertsPage.js"></script>

    <script>
        let consoleOutput = document.getElementById('console-output');
        let originalConsole = { ...console };
        let priceAlertsPageInstance = null;

        // åŠ«æŒ console è¼¸å‡º
        function interceptConsole() {
            ['log', 'error', 'warn', 'info'].forEach(method => {
                console[method] = function(...args) {
                    originalConsole[method].apply(console, args);
                    appendToConsole(`[${method.toUpperCase()}] ${args.join(' ')}`);
                };
            });
        }

        function appendToConsole(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            interceptConsole();
            appendToConsole('åƒ¹æ ¼è­¦å ±ä¿®å¾©æ¸¬è©¦å·¥å…·å·²æº–å‚™å°±ç·’');
        });

        // æ¸¬è©¦å‡½æ•¸
        async function testWithoutLogin() {
            appendToConsole('ğŸš« æ¸¬è©¦æœªç™»å…¥ç‹€æ…‹...');
            
            // æ¸…é™¤èªè­‰
            localStorage.removeItem('nexustrade_token');
            localStorage.removeItem('nexustrade_user');
            
            try {
                // å‰µå»º PriceAlertsPage å¯¦ä¾‹
                priceAlertsPageInstance = new PriceAlertsPage();
                
                // åˆå§‹åŒ–ï¼ˆæ‡‰è©²é¡¯ç¤ºç™»å…¥æç¤ºï¼‰
                await priceAlertsPageInstance.init();
                
                appendToConsole('âœ… æœªç™»å…¥æ¸¬è©¦å®Œæˆ - æ‡‰è©²é¡¯ç¤ºç™»å…¥æç¤ºç•Œé¢');
            } catch (error) {
                appendToConsole(`âŒ æœªç™»å…¥æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function setupLoginAndTest() {
            appendToConsole('âœ… è¨­ç½®ç™»å…¥ä¸¦æ¸¬è©¦...');
            
            // è¨­ç½®èªè­‰
            const mockToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ODY3YmM4NTJiODMxNmUwZDRiN2YyY2EiLCJlbWFpbCI6ImxpbmVfdWU1Y2MxODhlMWQyY2RiYWM1Y2ZkYTJhYmI2ZjZhMzRiQGV4YW1wbGUuY29tIiwibGluZUlkIjoiVWU1Y2MxODhlMWQyY2RiYWM1Y2ZkYTJhYmI2ZjZhMzRiIiwibGluZVVzZXJJZCI6IlVlNWNjMTg4ZTFkMmNkYmFjNWNmZGEyYWJiNmY2YTM0YiIsImdvb2dsZUlkIjpudWxsLCJwcm92aWRlciI6ImxpbmUiLCJtZW1iZXJzaGlwIjoiZnJlZSIsImlhdCI6MTc1MTY0Njg0NiwiZXhwIjoxNzUyMjUxNjQ2fQ.QEUm4SeOwkrXPikpyTQmqQbaHHXr_m50wug0Ri9iFng';
            const mockUser = {
                _id: '6867bc852b8316e0d4b7f2ca',
                email: 'line_ue5cc188e1d2cdbac5cfda2abb6f6a34b@example.com',
                googleId: null,
                lineId: 'Ue5cc188e1d2cdbac5cfda2abb6f6a34b',
                lineUserId: 'Ue5cc188e1d2cdbac5cfda2abb6f6a34b',
                provider: 'line',
                membership: 'free',
                status: 'active'
            };

            localStorage.setItem('nexustrade_token', mockToken);
            localStorage.setItem('nexustrade_user', JSON.stringify(mockUser));
            
            try {
                // å‰µå»º PriceAlertsPage å¯¦ä¾‹
                priceAlertsPageInstance = new PriceAlertsPage();
                
                // åˆå§‹åŒ–ï¼ˆæ‡‰è©²é¡¯ç¤ºæ­£å¸¸çš„è­¦å ±é é¢ï¼‰
                await priceAlertsPageInstance.init();
                
                appendToConsole('âœ… å·²ç™»å…¥æ¸¬è©¦å®Œæˆ - æ‡‰è©²é¡¯ç¤ºå®Œæ•´çš„è­¦å ±ç®¡ç†ç•Œé¢');
                
                // ç­‰å¾…ä¸€ä¸‹å¾Œæª¢æŸ¥æ–°å¢æŒ‰éˆ•
                setTimeout(() => {
                    const addBtn = document.getElementById('add-alert-btn');
                    if (addBtn) {
                        appendToConsole('âœ… æ–°å¢è­¦å ±æŒ‰éˆ•å­˜åœ¨ä¸”å¯é»æ“Š');
                        appendToConsole('ğŸ¯ æ¸¬è©¦é»æ“Šæ–°å¢æŒ‰éˆ•...');
                        
                        // æ¸¬è©¦é»æ“Š
                        addBtn.click();
                        
                        setTimeout(() => {
                            const modal = document.getElementById('create-alert-modal');
                            if (modal && (modal.style.display === 'flex' || modal.style.display === 'block')) {
                                appendToConsole('ğŸ‰ æˆåŠŸï¼æ–°å¢è­¦å ±æ¨¡æ…‹æ¡†å·²é¡¯ç¤º');
                            } else {
                                appendToConsole('âš ï¸ æ¨¡æ…‹æ¡†æœªé¡¯ç¤ºï¼Œå¯èƒ½éœ€è¦é€²ä¸€æ­¥æª¢æŸ¥');
                            }
                        }, 500);
                    } else {
                        appendToConsole('âŒ æ–°å¢è­¦å ±æŒ‰éˆ•ä¸å­˜åœ¨');
                    }
                }, 1000);
                
            } catch (error) {
                appendToConsole(`âŒ å·²ç™»å…¥æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        function clearAuth() {
            localStorage.removeItem('nexustrade_token');
            localStorage.removeItem('nexustrade_user');
            appendToConsole('ğŸ—‘ï¸ èªè­‰ç‹€æ…‹å·²æ¸…é™¤');
        }

        function refreshUserQuota() {
            appendToConsole('ğŸ”„ é‡æ–°æ•´ç†é…é¡...');
            
            if (priceAlertsPageInstance) {
                // é‡æ–°è¼‰å…¥è­¦å ±è³‡æ–™
                priceAlertsPageInstance.loadAlerts()
                    .then(() => {
                        appendToConsole('âœ… è­¦å ±è³‡æ–™å·²é‡æ–°è¼‰å…¥');
                        
                        // æª¢æŸ¥æ˜¯å¦æœ‰è­¦å ±é¡¯ç¤º
                        setTimeout(() => {
                            const alertsCount = priceAlertsPageInstance.alerts.length;
                            appendToConsole(`ğŸ“Š ç›®å‰é¡¯ç¤º ${alertsCount} å€‹è­¦å ±`);
                            
                            if (alertsCount > 0) {
                                appendToConsole('ğŸ‰ è­¦å ±è³‡æ–™è¼‰å…¥æˆåŠŸï¼');
                                priceAlertsPageInstance.alerts.forEach((alert, index) => {
                                    appendToConsole(`   ${index + 1}. ${alert.symbol} - ${alert.alertType} (${alert.status})`);
                                });
                            } else {
                                appendToConsole('âš ï¸ æ²’æœ‰æ‰¾åˆ°è­¦å ±è³‡æ–™');
                            }
                        }, 500);
                    })
                    .catch(error => {
                        appendToConsole(`âŒ é‡æ–°è¼‰å…¥å¤±æ•—: ${error.message}`);
                    });
            } else {
                appendToConsole('âŒ PriceAlertsPage å¯¦ä¾‹ä¸å­˜åœ¨');
            }
        }

        // æ¨¡æ“¬å…¨åŸŸç™»å…¥æ¨¡æ…‹æ¡†å‡½æ•¸
        window.showLoginModal = function() {
            appendToConsole('ğŸ” å…¨åŸŸç™»å…¥æ¨¡æ…‹æ¡†è¢«èª¿ç”¨');
            alert('é€™è£¡æœƒé¡¯ç¤ºç™»å…¥æ¨¡æ…‹æ¡†');
        };
    </script>
</body>
</html>